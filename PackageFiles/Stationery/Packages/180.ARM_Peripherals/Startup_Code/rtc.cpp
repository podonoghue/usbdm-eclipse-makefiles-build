/*
 * @file rtc.cpp (180.ARM_Peripherals/Startup_Code/rtc.cpp)
 *
 *  Created on: 21/09/2013
 *      Author: podonoghue
 */

#include <sys/time.h>
#include "derivative.h"
#include "rtc.h"
 /*
 * *****************************
 * *** DO NOT EDIT THIS FILE ***
 * *****************************
 *
 * This file is generated automatically.
 * Any manual changes will be lost.
 */
#if $(/RTC/enablePeripheralSupport:false) // /RTC/enablePeripheralSupport
/*
 * To support time.h functions
 *
 * @param tp
 * @param tzp
 */
extern "C" __attribute__ ((__weak__))
int _gettimeofday(struct timeval *tp, void *) {
   // Enable RTC interface
   USBDM::Rtc::enableClock();
   tp->tv_sec  = USBDM::Rtc::getTime();
   tp->tv_usec = 0;
   return 0;
}

/*
 * To support time.h functions
 *
 * @param tp
 * @param tzp
 */
extern "C"
int settimeofday(const struct timeval *tp, const struct timezone *) {
   // Enable RTC interface
   USBDM::Rtc::enableClock();
   USBDM::Rtc::setTime(tp->tv_sec);
   return 0;
}
#endif
