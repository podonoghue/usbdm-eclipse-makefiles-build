<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE fragment SYSTEM "_menu.dtd" >
<!-- llwu_base.xml -->

<fragment xmlns:xi="http://www.w3.org/2001/XInclude">

   <equation key="irq_parameters"            value=""  />
   <equation key="irq_dummy_parameters"      value=""  />
   <equation key="irq_call"                  value=""  />
   <equation key="generateDefault"           value="false"         />
   <equation key="configureInStartupDefault" value="false"         />
   <xi:include href="enablePeripheral.xml"  />
   <title description="------------------------------------------" />

   <!-- ************* Class Declaration ****************** -->
   <constant key="_class_declaration" type="String"
      value="&quot;$(_Class)Info : public $(_Baseclass)BasicInfo&quot;" />

   <!-- ******************************** ME ******************************** -->

   <equation key="index" value="=0" />
   <for keys="p" values="=/LLWU/llwu_device_list" condition="llwu_device_list" >
      <signal name='="LLWU_M"+ToString(index)' pin="%(p)" condition='"%(p)"!=""' />
      <equation key="index" value="=index+1"/>
   </for>

   <choiceOption key="llwu_me_peripherals" condition="llwu_me_wume0_present"
      enabledBy="enablePeripheralSupport"
      hidden="true"
      derived="true"
      valueFormat="%s"
      typeName="LlwuPeripheral"
      baseType="uint8_t"
      description="LLWU peripheral wake-up source"
      toolTip="Peripheral used as wake-up source"
      enumText="$(/LLWU/InputModuleMapping:// No wake-up peripherals found)"
      >
      <choice name="No wake-up peripheral" value="0"          enum="None" />
      <choiceExpansion name="Wake-up by %(p)" value="1U&lt;&lt;%(i)" enum='=Prettify("%(p)")' signal="LLWU_M%(i)"
                       keys="p" values="=llwu_device_list" delimiter=";" condition='="%(p)"!=""'/>
   </choiceOption>

   <binaryOption key="llwu_me_wume" condition="llwu_me_wume0_present"
      hidden="true"
      derived="true"
      typeName="LlwuPeripheralWakeup"
      valueFormat="%s"
      description="LLWU peripheral wake-up control"
      toolTip="Whether this peripheral can wake-up the processor">
      <choice name="Wake-up disabled" value="false" enum="Disabled" isDefault="true" />
      <choice name="Wake-up enabled"  value="true"  enum="Enabled" />
   </binaryOption>

   <category name="Peripheral sources" description="Wakeups from peripherals">

      <equation key="index" value="=0" />
      <for keys="p" values="=/LLWU/llwu_device_list" condition="llwu_device_list" >
         <binaryOption key='="llwu_me_wume"+ToString(index)' condition='="%(p)"!=""'
            derivedFrom="llwu_me_wume"
            enabledBy="enablePeripheralSupport"
            typeName="LlwuPeripheral"
            description="Wake-up by %(p)"
            signal='="LLWU_M"+ToString(index)' >
            <choice name="Wake-up disabled" value="false"            enum="None"              isDefault="true" />
            <choice name="Wake-up enabled"  value="=ToString(index)" enum='=Prettify("%(p)")' />
         </binaryOption>
         <equation key="index" value="=index+1"/>
      </for>

   </category>

   <variableTemplate key="llwu_base_methods" codeGenCondition="enablePeripheralSupport"
      variables="llwu_me_peripherals,llwu_me_wume"
      nonDefaultParams="2" ><![CDATA[
      \t/**
      \t * Configure %description0
      \t *
      %paramDescription
      \t */
      \tstatic void configurePeripheralSource(%params) {
      \t
      \t   if (%paramName1) {
      \t      %register = %register | %paramName0;
      \t   }
      \t   else {
      \t      %register = %register & (uint8_t)~%paramName0;
      \t   }
      \t}
      \t
      \t/**
      \t * Get flag bit mask indicating wake-up peripheral sources
      \t * The mask returned correspond to (multiple) peripheral sources.
      \t * These flags are cleared through the originating peripheral.
      \t *
      \t *
      \t * Example checking source
      \t * @code
      \t *    if ((peripheralWakeupSource&LlwuPeripheral_Lptmr) != 0) {
      \t *       // Wake-up from LPTMR
      \t *    }
      \t * @endcode
      \t *
      \t * @return Bit mask
      \t */
      \tstatic uint32_t getPeripheralWakeupSources() {
      \t   return llwu->MF;
      \t}

      \t/**
      \t *  Check if peripheral is source of wake-up
      \t *  These flags are cleared through the originating peripheral.
      \t *
      %paramDescription0
      \t *
      \t * @return false Given peripheral is not source of wake-up.
      \t * @return true  Given peripheral is source of wake-up.
      \t */
      \tstatic bool isPeripheralWakeupSource(%paramType0 %paramName0) {
      \t   return llwu->MF & %paramName0;
      \t}\n\n
   ]]></variableTemplate>

   <!-- ******************************** RST ******************************** -->

   <binaryOption key="llwu_rst_llrste" condition="llwu_rst_llrste_present"
      enabledBy="enablePeripheralSupport"
      typeName="LlwuResetWakeup"
      description="Low-Leakage Mode RESET Enable"
      toolTip="This bit must be set to allow the device to be reset while in a low-leakage power mode.\n
         On devices where Reset is not a dedicated pin, the RESET pin must also be enabled\n
         in the explicit port mux control" >
      <choice name="RESET not enabled as LLWU exit source" enum="Disabled" value="0" />
      <choice name="RESET enabled as LLWU exit source"     enum="Enabled"  value="1" isDefault="true" />
   </binaryOption>

   <binaryOption key="llwu_rst_rstfilt" condition="llwu_rst_rstfilt_present"
      enabledBy="enablePeripheralSupport"
      typeName="LlwuResetFilter"
      description="Digital Filter On RESET Pin"
      toolTip="Enables the digital filter for the RESET pin during LLS, VLLS3, VLLS2, or VLLS1 modes" >
      <choice name="Filter not enabled" enum="Disabled" value="0" isDefault="true" />
      <choice name="Filter enabled"     enum="Enabled"  value="1" />
   </binaryOption>

   <variableTemplate key="llwu_base_methods" variables="llwu_rst_rstfilt,llwu_rst_llrste" codeGenCondition="enablePeripheralSupport" ><![CDATA[
      \t/**
      \t * Controls Reset wake-up control
      \t *
      %paramDescription
      \t */
      \tstatic void configureResetFilter(%params) {
      \t   %register = %paramExpression;
      \t}\n
   ]]></variableTemplate>

   <choiceOption key="llwu_pe"  condition="llwu_pe1_wupe0_present"
      hidden="true"
      derived="true"
      enabledBy="enablePeripheralSupport"
      typeName="LlwuPinMode"
      description="Wake-up pin control"
      toolTip="Enables and configures the edge detection for a wake-up pin"
      valueFormat="LLWU_PE1_WUPE0(%s),LLWU_PE1_WUPE1(%s),LLWU_PE1_WUPE2(%s),LLWU_PE1_WUPE3(%s)"
      >
      <choice name="Wake-up pin disabled"         enum="Disabled"     value="0,0,0,0" isDefault="true" />
      <choice name="Wake-up on pin rising edge"   enum="RisingEdge"   value="1,1,1,1" />
      <choice name="Wake-up on pin falling edge"  enum="FallingEdge"  value="2,2,2,2" />
      <choice name="Wake-up on pin either edge"   enum="EitherEdge"   value="3,3,3,3" />
   </choiceOption>

   <category name="Pin sources" description="Wakeups from pins">

      <!-- ******************************** PEx ******************************** -->

      <for keys="pin" dim="32" >
         <choiceOption key='="llwu_pe"+ToString((%(pin)/4)+1)+"_wupe"+ToString(%(pin))' condition='=SignalExists("LLWU_P%(pin)")'
            enabledBy="enablePeripheralSupport"
            typeName="LlwuPinMode"
            description='="Wake-up by "+OnlyMappablePinOfSignal("LLWU_P%(pin)")+" [LLWU_P%(pin)]"'
            valueFormat='="(LLWU_PE"+ToString(1+(%(pin)/4))+"_WUPE"+ToString(%(pin))+"_MASK&amp;(%s))"'
            toolTip="Enables and configures the edge detection for the wake-up pin"
            signal="LLWU_P%(pin)" >
            <choice name="Wake-up pin disabled"        value="LlwuPinMode_Disabled"    enum="Disabled"     isDefault="true" />
            <choice name="Wake-up on pin rising edge"  value="LlwuPinMode_RisingEdge"  enum="RisingEdge"    />
            <choice name="Wake-up on pin falling edge" value="LlwuPinMode_FallingEdge" enum="FallingEdge"   />
            <choice name="Wake-up on pin either edge"  value="LlwuPinMode_EitherEdge"  enum="EitherEdge"    />
         </choiceOption>
      </for>

   <!-- ******************************** FILTx ******************************** -->

      <choiceOption key="pin_filter_numbers" condition="llwu_filt1_filte_present"
         hidden="true"
         derived="true"
         valueFormat="%s"
         description="Pin filter numbers"
         toolTip="These are used as an index into the FILT table so \n
                  do NOT correspond to filter names e.g. FILT1 = FILT[0] etc"
         typeName="LlwuFilterNum"
         baseType="uint8_t"
         >
         <choiceExpansion
            name="Wake-up pin filter %(i)" value="=ToString(%(i)-1)" enum="%(i)"
            condition='=Exists("llwu_filt%(i)_filte_present")'
            keys="i" dim="1,8" />
      </choiceOption>

      <choiceOption key="pin_numbers"
         valueFormat="%s"
         hidden="true"
         derived="true"
         typeName="LlwuPin"
         baseType="uint8_t"
         description="Filter Pin Select"
         toolTip="Selects 1 of the pins to be muxed into the filter"
         enumText="
         $(/LLWU/InputPinMapping:// No user pin mappings found)"
      >
         <choiceExpansion name='@SignalDescription("LLWU_P%(i)","^(.*?)\|(.*?)\|(.*?)\|(.*?)\|(.*?)$","$4")'
                          value="%(i)"
                          enum='=Prettify(OnlyMappablePinOfSignal("LLWU_P%(i)"))'
                          signal="LLWU_P%(i)"
                          condition='=SignalExists("LLWU_P%(i)")'
                          keys="i" dim="32" />
      </choiceOption>
      
      <title description="Filtered pins" />
      <choiceOption key="llwu_filt_filte"  condition="llwu_filt1_filte_present"
         hidden="true"
         derived="true"
         enabledBy="enablePeripheralSupport"
         typeName="LlwuFilterPinMode"
         description="Pin Filter Mode"
         toolTip="Controls the digital filter options for the filtered external pin detect ">
         <choice name="Wake-up disabled"                  enum="Disabled"     value="0" isDefault="true" />
         <choice name="Wake-up on filtered rising edge"   enum="RisingEdge"   value="1" />
         <choice name="Wake-up on filtered falling edge"  enum="FallingEdge"  value="2" />
         <choice name="Wake-up on either filtered edge"   enum="EitherEdge"   value="3" />
      </choiceOption>

      <for keys="n" dim="1,4" >
         <choiceOption key="llwu_filt%(n)_filte"   condition="llwu_filt%(n)_filte_present"
            enabledBy="enablePeripheralSupport"
            description="Pin Filter %(n) Mode"
            derivedFrom="llwu_filt_filte"   />

         <choiceOption key="llwu_filt%(n)_filtsel" condition="llwu_filt%(n)_filtsel_present"
            enabledBy="llwu_filt%(n)_filte != 0"
            derivedFrom="pin_numbers"
            description="Pin Filter %(n) Pin Select">
         </choiceOption>
      </for>
   </category>

<!--   ========== LLWU Init class =============================== -->

   <template where="basicInfo" codeGenCondition="/$(_STRUCTNAME)/generateSharedInfo" >
   <![CDATA[
      \t/**
      \t * Class used to do initialisation of the $(_Class)
      \t *
      \t * This class has a templated constructor that accepts various values:
      \t * - llwuPeripheral,                            - Peripheral to enable as wake-up source
      \t * - llwuPin, llwuPinMode,                      - Pin to enable as direct wake-up source
      \t * - llwuFilterNum, llwuPin, llwuFilterPinMode, - Pin to enable as filtered wake-up source
      \t *
      \t * @note This constructor may be used to create a const instance in Flash
      \t *
      \t * Example:
      \t * @code
      \t * ///
      \t * /// $(_NAME) call-back
      \t * ///
      \t * /// @param status  Status reflecting active inputs
      \t * ///
      \t * void $(_name)Callback(uint32_t status) {
      \t *    (void) status;
      \t * }
      \t *
      \t * static const $(_Class)::Init $(_name)Init {
      \t *    // Pins
      \t *    LlwuPin_Pta4,  LlwuPinMode_FallingEdge,
      \t *    LlwuPin_Pta13, LlwuPinMode_EitherEdge,
      \t *    LlwuPin_Ptd4,  LlwuPinMode_RisingEdge,
      \t *
      \t *    // Filtered Pins
      \t *    LlwuFilterNum_1, LlwuPin_Pta4, LlwuFilterPinMode_EitherEdge,
      \t *    LlwuFilterNum_2, LlwuPin_Ptc3, LlwuFilterPinMode_RisingEdge,
      \t *
      \t *    // Peripherals
      \t *    LlwuPeripheral_RtcAlarm,
      \t *    LlwuPeripheral_Lptmr0,
      \t *
      \t *    // Reset
      \t *    LlwuResetWakeup_Enabled, LlwuResetFilter_Enabled
      \t * };
      \t *
      \t * // Initialise $(_Class) from values specified above
      \t * $(_Class)::configure($(_name)Init)
      \t * @endcode
      \t */
      \t
      \tclass Init {
      \t
      \tpublic:
      \t   /**
      \t    * Copy Constructor
      \t    */
      \t   constexpr Init(const Init &other) = default;
      \t
      \t   /**
      \t    * Default Constructor
      \t    */
      \t   constexpr Init() = default;
      \t\n
   ]]>
   </template>

<!--   Member variables -->

   <variableTemplate where="basicInfo" codeGenCondition="irqHandlingMethod"
      variables="irqHandlingMethod"
    ><![CDATA[
      \t   /// %description
      \t   %params = nullptr;\n\n
   ]]></variableTemplate>

   <variableTemplate where="basicInfo" codeGenCondition="enablePeripheralSupport"
      variables="/PCR/nvic_irqLevel,irqLevel"
   ><![CDATA[
      \t   /// %description
      \t   %paramType %registerName0 = %defaultValue;
      \t\n
   ]]></variableTemplate>

   <template where="basicInfo" codeGenCondition="enablePeripheralSupport" >
   <![CDATA[
      \t   /// Array to assist with mapping Pin to register bit-mask
      \t   static constexpr uint8_t masks[] =
      \t      {LLWU_PE1_WUPE0_MASK, LLWU_PE1_WUPE1_MASK, LLWU_PE1_WUPE2_MASK, LLWU_PE1_WUPE3_MASK, };
      \t\n
   ]]></template>

   <for keys="n" values="8;7;6;5;4;3;2;1" >
      <if condition='="llwu_pe%(n)_wupe"+ToString((%(n)-1)*4)+"_present"' >
         <template where="basicInfo" codeGenCondition="enablePeripheralSupport" ><![CDATA[
            \t
            \t   /// Pin sources enable
            \t   uint8_t pe[%(n)]   = {0};\n
         ]]></template>
         <break/>
      </if>
   </for>

   <for keys="n" values="4;3;2;1" >
      <if condition="llwu_filt%(n)_filte">
         <template where="basicInfo" codeGenCondition="enablePeripheralSupport"><![CDATA[
            \t
            \t   /// Filter configurations
            \t   uint8_t filt[%(n)] = {0};\n
         ]]></template>
         <break/>
      </if>
   </for>

   <variableTemplate where="basicInfo" codeGenCondition="enablePeripheralSupport"
      variables="llwu_me_peripherals"
   ><![CDATA[
      \t
      \t   /// Module (peripheral) sources enable
      \t   uint8_t %registerName      = 0;\n
   ]]></variableTemplate>

   <variableTemplate where="basicInfo" codeGenCondition="enablePeripheralSupport"
      variables="llwu_rst_llrste"
   ><![CDATA[
      \t
      \t   /// Reset Pin Filter configuration
      \t   uint8_t %registerName     = 0;\n
   ]]></variableTemplate>

<!--   Constructors -->

   <variableTemplate where="basicInfo" codeGenCondition="irqHandlingMethod"
      variables="irqHandlingMethod"
      linePadding="xxx"
    ><![CDATA[
      \t   /**
      \t    * Constructor for %description
      \t    *
      \t    * @tparam   Types
      \t    * @param    rest
      %paramDescription
      \t    */
      \t   template <typename... Types>
      \t   constexpr Init(%params, Types... rest) : Init(rest...) {
      \t
      \t      this->%paramName0 = %paramExpression;
      \t   }\n\n
   ]]></variableTemplate>

   <variableTemplate where="basicInfo" codeGenCondition="enablePeripheralSupport"
      variables="/PCR/nvic_irqLevel"
      linePadding="xxx"
    ><![CDATA[
      \t   /**
      \t    * Constructor for %description
      \t    *
      \t    * @tparam   Types
      \t    * @param    rest
      %paramDescription
      \t    */
      \t   template <typename... Types>
      \t   constexpr Init(%params, Types... rest) : Init(rest...) {
      \t
      \t      %registerName = %paramExpression;
      \t   }\n\n
   ]]></variableTemplate>

   <variableTemplate where="basicInfo" codeGenCondition="enablePeripheralSupport"
      variables="llwu_me_peripherals"
   ><![CDATA[
      \t   /**
      \t    * Constructor for %description
      \t    *
      \t    * @tparam   Types
      \t    * @param    rest
      \t%paramDescription
      \t    */
      \t   template <typename... Types>
      \t   constexpr Init(%params, Types... rest) : Init(rest...) {
      \t
      \t      %registerName |= %paramExpression;
      \t   }
      \t\n
   ]]></variableTemplate>

   <template where="basicInfo" condition="llwu_filt1_filte" codeGenCondition="enablePeripheralSupport" ><![CDATA[
      \t   /**
      \t    * Constructor for filtered pin source
      \t    *
      \t    * @tparam Types
      \t    * @param rest
      \t    *
      \t    * @param llwuFilterNum       Filter to use
      \t    * @param llwuPin             Peripheral to enable as wake-up source
      \t    * @param llwuFilterPinMode   Sensitivity of pin
      \t    */
      \t   template <typename... Types>
      \t   constexpr Init(
      \t         LlwuFilterNum     llwuFilterNum,
      \t         LlwuPin           llwuPin,
      \t         LlwuFilterPinMode llwuFilterPinMode,
      \t         Types... rest) : Init(rest...) {
      \t
      \t      // LLWU_FILT_FILTF_MASK clears flag on write to register
      \t      filt[llwuFilterNum] = LLWU_FILT_FILTF_MASK|llwuFilterPinMode|llwuPin;
      \t   }
      \t\n
   ]]></template>

   <template where="basicInfo" codeGenCondition="enablePeripheralSupport" ><![CDATA[
      \t   /**
      \t    * Constructor for unfiltered pin source
      \t    *
      \t    * @tparam Types
      \t    * @param rest
      \t    *
      \t    * @param llwuPin       Peripheral to enable as wake-up source
      \t    * @param llwuPinMode   Sensitivity of pin
      \t    */
      \t   template <typename... Types>
      \t   constexpr Init(LlwuPin llwuPin, LlwuPinMode llwuPinMode, Types... rest) : Init(rest...) {
      \t
      \t      const uint8_t  mask  = masks[llwuPin&3];
      \t      const int      index = llwuPin>>2;
      \t
      \t      pe[index] = (pe[index]&~mask) | (llwuPinMode & mask);
      \t   }
      \t\n
   ]]></template>

   <template where="basicInfo" condition="llwu_rst_llrste" codeGenCondition="enablePeripheralSupport" ><![CDATA[
      \t   /**
      \t    * Constructor for Reset as wake-up source
      \t    *
      \t    * @tparam Types
      \t    * @param rest
      \t    *
      \t    * @param llwuResetWakeup  Enable/Disable Reset source
      \t    * @param llwuResetFilter  Enable/Disable Reset pin filter
      \t    */
      \t   template <typename... Types>
      \t   constexpr Init(LlwuResetWakeup llwuResetWakeup, LlwuResetFilter llwuResetFilter, Types... rest) : Init(rest...) {
      \t
      \t      rst = llwuResetWakeup|llwuResetFilter;
      \t   }
      \t\n
   ]]></template>

<!--   Default Initialisation value -->

   <template codeGenCondition="enablePeripheralSupport"
   ><![CDATA[
      \t// LLWU default init value
      \tstatic constexpr LlwuInfo::Init DefaultInitValue {\n
   ]]></template>
   <for keys="n" dim="8" >
      <variableTemplate codeGenCondition="enablePeripheralSupport&amp;&amp;(llwu_me_wume%(n))"
         variables="llwu_me_wume%(n)"
         terminator=","
         separator=","
      ><![CDATA[
         %initExpression  \n
      ]]></variableTemplate>
   </for>

   <for keys="p" dim="32" >
      <equation key="pin" value='="LlwuPin_"+Prettify(OnlyMappablePinOfSignal("LLWU_P%(p)"))' condition='=SignalExists("LLWU_P%(p)")' />
      <equation key="var" value='="llwu_pe"+Prettify(ToString(1+(%(p)/4))+"_wupe%(p)")' />
      <equation key="genCode" value='="enablePeripheralSupport&amp;&amp;("+var+"&gt;0)"' />
      <!--
      <printVar key="pin"/>
      <printVar key="var"/>
      <printVar key="genCode"/>
       -->
      <variableTemplate codeGenCondition="=genCode" condition='=SignalExists("LLWU_P%(p)")'
         immediateVariables="pin"
         variables='=var'
         terminator=","
         separator=","
         initExpressionOnSameLine="true"
      ><![CDATA[
          \t   $(pin), %initExpression, \n
      ]]></variableTemplate>
   </for>
   <for keys="n" values="1;2;3;4">
      <variableTemplate codeGenCondition="enablePeripheralSupport&amp;&amp;(llwu_filt%(n)_filte>0)"
         variables="llwu_filt%(n)_filtsel, llwu_filt%(n)_filte"
         terminator=","
         separator=","
         initExpressionOnSameLine="true"
      ><![CDATA[
         \t   LlwuFilterNum_%(n), %initExpression, \n
      ]]></variableTemplate>
   </for>

   <variableTemplate codeGenCondition="enablePeripheralSupport"
      variables="llwu_rst_llrste, llwu_rst_rstfilt, irqLevel"
      terminator=","
      separator=","
   ><![CDATA[
      \t   %initExpression,  \n
   ]]></variableTemplate>

   <template codeGenCondition="enablePeripheralSupport"
   ><![CDATA[
      \t};\n\n
   ]]></template>

<!--   Configure methods -->

   <template codeGenCondition="enablePeripheralSupport" ><![CDATA[
      \t
      \t/**
      \t * Configure with default settings.
      \t * Configuration determined from Configure.usbdmProject
      \t */
      \tstatic inline void defaultConfigure() {
      \t
      \t   // Update settings
      \t   configure(DefaultInitValue);
      \t}
      \t\n
   ]]></template>

   <template codeGenCondition="enablePeripheralSupport" >
   <![CDATA[
      \t
      \t/**
      \t * Configure $(_BASENAME) from values specified in init
      \t * $(_BASENAME) flags from pin events are cleared.
      \t * Requests from peripheral devices must be cleared at source
      \t *
      \t * @param init Class containing initialisation values
      \t */
      \tstatic void configure(const Init &init) {
      \t
      \t\n
   ]]></template>
   <template codeGenCondition="irqHandlingMethod"
      condition="irqHandlingMethod" >
   <![CDATA[
      \t   setCallback(init.callbackFunction);
      \t\n
   ]]></template>
   <variableTemplate codeGenCondition="enablePeripheralSupport"
      variables="irqLevel" >
   <![CDATA[
      \t   enableNvicInterrupts(init.irqlevel);
      \t\n
   ]]></variableTemplate>
   <for keys="r" dim="1,4" >
      <template codeGenCondition="enablePeripheralSupport"
         condition='="llwu_pf%(r)_present"' >
      <![CDATA[
         \t   // Clear pin flags
         \t   llwu->PF%(r) = 0xFF;\n
      ]]></template>
   </for>
   <for keys="r" dim="8" >
      <equation key="reg" value='="llwu->PE"+ToString(%(r)+1)' />
      <template codeGenCondition="enablePeripheralSupport"
         condition='="llwu_pe"+ToString(%(r)+1)+"_present"'
         immediateVariables="reg" >
      <![CDATA[
         \t   // Configure pin sources
         \t   $(reg)  = init.pe[%(r)];\n
      ]]></template>
   </for>

   <for keys="r" dim="8" >
      <equation key="reg" value='="llwu->FILT"+ToString(%(r)+1)' />
      <template codeGenCondition="enablePeripheralSupport"
         condition='="llwu_filt"+ToString(%(r)+1)+"_filte_present"'
         immediateVariables="reg" >
      <![CDATA[
         \t   // Configure and clear filtered pin source
         \t   $(reg) = init.filt[%(r)];\n
      ]]></template>
   </for>

   <variableTemplate codeGenCondition="enablePeripheralSupport"
      variables="llwu_me_peripherals" >
   <![CDATA[
      \t   // Configure peripheral sources
      \t   %register    = init.%registerName;\n
   ]]></variableTemplate>
   <variableTemplate codeGenCondition="enablePeripheralSupport"
      variables="llwu_rst_llrste" >
   <![CDATA[
      \t   // Configure filtered reset pin source
      \t   %register   = init.%registerName;\n
   ]]></variableTemplate>
   <template  codeGenCondition="enablePeripheralSupport" >
   <![CDATA[
      \t};\n\n
   ]]></template >

   <template where="basicInfo" codeGenCondition="/$(_STRUCTNAME)/generateSharedInfo" >
      <![CDATA[
      \t}; // $(_Class)BasicInfo::Init\n\n
   ]]>
   </template>

   <!-- ************* Common ****************** -->

   <template key="/$(_BASENAME)/declarations" codeGenCondition="enablePeripheralSupport" ><![CDATA[
      \t/**
      \t * Class representing $(_NAME)
      \t */
      \tclass $(_Class) : public $(_Baseclass)Base_T<$(_Class)Info> {};\n
   ]]></template>

   <validate
      class="net.sourceforge.usbdm.deviceEditor.validators.LlwuValidate">
   </validate>

   <projectActionList id = "llwu_files" >
      <copy source="Project_Headers/llwu.h"            target="Project_Headers/llwu.h"            overwrite="true" derived="true" />
      <copy source="Snippets/llwu-simple-example.cpp"  target="Snippets/llwu-simple-example.cpp"  overwrite="true" derived="true" />
   </projectActionList>

   <!-- ************* Startup ****************** -->

   <template key="/SYSTEM/Includes" condition="configurePeripheralInStartUp" codeGenCondition="configurePeripheralInStartUp" >
      <![CDATA[#include "$(_basename).h"\n
   ]]></template>

   <template key="/SYSTEM/Startup" condition="configurePeripheralInStartUp" codeGenCondition="configurePeripheralInStartUp" >
   <![CDATA[
      \t/*  Initialise $(_Class) */
      \tUSBDM::$(_Class)::defaultConfigure();\n
   ]]></template>

   <!-- ************* Signal mapping ****************** -->

   <signals enabledBy="enablePeripheralSupport" />

</fragment>
