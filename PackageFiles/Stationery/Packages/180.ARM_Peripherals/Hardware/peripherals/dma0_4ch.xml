<?xml version="1.0" encoding="UTF-8"
?>
<!DOCTYPE peripheralPage SYSTEM "_menu.dtd" >
<!-- dma0_4ch.xml -->

<peripheralPage xmlns:xi="http://www.w3.org/2001/XInclude" name="_instance" description="DMA Module">

   <xi:include href="_default_instance.xml"/>

   <intOption key="NumChannels" constant="true" derived="true"
      description="Number of DMA channels" 
      toolTip="The number of DMA channels available" 
      value="4" />

   <intOption key="NumVectors" constant="true" derived="true"
      description="Number of DMA interrupt vectors" 
      toolTip="Number of DMA interrupt vectors - \n
               Multiple channels may be mapped to the same vector" 
      value="4" />
      
   <template><![CDATA[
      \t/** 
      \t *  Enable clock to $(_class)
      \t */
      \tstatic void enableClock() {
      #ifdef PCC
      \t   // DMA is always clocked
      #else
      \t   $(clockEnable)
      #endif
      \t}

      \t/** 
      \t *  Disable clock to $(_class)
      \t */
      \tstatic void disableClock() {
      #ifdef PCC
      \t   // DMA is always clocked
      #else
      \t   $(clockDisable)
      #endif
      \t}\n\n
   ]]></template>
      
   <stringOption key="irq_pattern"        constant="true" value="^%b_?(\d+)(_DMA.*)?$;^%b_Error.*$" hidden="true" />
   <stringOption key="irq_classHandler"   constant="true" value="%c%i::irqHandler&lt;$1&gt;;%c%i::errorIrqHandler" hidden="true" />
   <xi:include href="_irqOptionSubstituted.xml"/>
 
   <validate
      class="net.sourceforge.usbdm.deviceEditor.validators.PeripheralValidator">
   </validate>

   <template key="/DMA/declarations" namespace="all"  ><![CDATA[
   \t/**
   \t * Class representing DMAMUX$(_instance)
   \t */
   \ttypedef $(_base_class)Mux_T<Dmamux$(_instance)Info, Dma$(_instance)Info::NumChannels> DmaMux$(_instance);
   \t/**
   \t * Class representing $(_name)
   \t */
   \ttypedef $(_base_class)Base_T<$(_class)Info> $(_class);\n
   ]]></template>
      
   <template><![CDATA[
      \t//! Number of DMA channels implemented
      \tstatic constexpr unsigned NumChannels = $(NumChannels);

      \t//! Number of DMA vectors implemented
      \tstatic constexpr unsigned NumVectors = $(NumVectors);\n\n
   ]]></template>
   
   <projectActionList id = "dma_files" >
      <copy source="Project_Headers/dma-MK.h"                   target="Project_Headers/dma.h"                      overwrite="true"  derived="true" />
      <copy source="Snippets/dma-memory-example.cpp"            target="Snippets/dma-memory-example.cpp"            overwrite="true"  derived="true" />
      <copy source="Snippets/dma-memory-template-example.cpp"   target="Snippets/dma-memory-template-example.cpp"   overwrite="true"  derived="true" />
      <copy source="Snippets/dma-uart-example-mk20.cpp"         target="Snippets/dma-uart-example-mk20.cpp"         overwrite="true"  derived="true" />
      <copy source="Snippets/dma-uart-example-mk22f.cpp"        target="Snippets/dma-uart-example-mk22f.cpp"        overwrite="true"  derived="true" />
      <copy source="Snippets/dma-uart-example-mk28f.cpp"        target="Snippets/dma-uart-example-mk28f.cpp"        overwrite="true"  derived="true" />
      <copy source="Snippets/dma-spi-example.cpp"               target="Snippets/dma-spi-example.cpp"               overwrite="true"  derived="true" />
      <copy source="Snippets/pit-adc-dma-example.cpp"           target="Snippets/pit-adc-dma-example.cpp"           overwrite="true"  derived="true" />
   </projectActionList>

</peripheralPage>
