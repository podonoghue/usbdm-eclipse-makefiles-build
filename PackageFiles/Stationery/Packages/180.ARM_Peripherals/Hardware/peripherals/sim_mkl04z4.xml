<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE peripheralPage SYSTEM "_menu.dtd" >
<!-- sim_mkl04z4.xml -->

<peripheralPage xmlns:xi="http://www.w3.org/2001/XInclude" name="_instance" description="SIM">
    
   <xi:include href="_default_instance.xml"/>

   <xi:include href="_sim_rtc_shared.xml"/>

   <category name="COPC" description="COP Control Register">
      
      <choiceOption name="sim_copc_copt" 
         description="COP Watchdog Timeout"
         toolTip="This write-once field selects the Computer Operating Properly Timeout" >
         <choice value="SIM_COPC_COPCLKS(0)|SIM_COPC_COPT(0)" name="Disabled" />
         <choice value="SIM_COPC_COPCLKS(0)|SIM_COPC_COPT(1)" name="Timeout after 2^5 LPO (1kHz) cycles" />
         <choice value="SIM_COPC_COPCLKS(0)|SIM_COPC_COPT(2)" name="Timeout after 2^8 LPO (1kHz) cycles" />
         <choice value="SIM_COPC_COPCLKS(0)|SIM_COPC_COPT(3)" name="Timeout after 2^10 LPO (1kHz) cycles" />
         <choice value="SIM_COPC_COPCLKS(1)|SIM_COPC_COPT(1)" name="Timeout after 2^13 bus clock cycles" />
         <choice value="SIM_COPC_COPCLKS(1)|SIM_COPC_COPT(2)" name="Timeout after 2^16 bus clock cycles" />
         <choice value="SIM_COPC_COPCLKS(1)|SIM_COPC_COPT(3)" name="Timeout after 2^18 bus clock cycles" />
      </choiceOption>

      <binaryOption name="sim_copc_copw" 
         description="COP Windowed Mode"
         toolTip="Windowed mode is only supported when COP is using bus clock.\n
                  The COP window is opened three quarters through the timeout period">
         <choice value="0"  name="Normal Mode" isDefault="true" />
         <choice value="1"  name="Windowed Mode" />
      </binaryOption>
      
   </category>

   <choiceOption name="adc_cfg1_adiclk" description="ADC Clock Source"
      toolTip="Clock source for the ADC module"
      hidden="true" >
      <choice value="0" name="Bus clock"                   data="Bus#SystemBusClock"                  />
      <choice value="1" name="Bus clock/2"                 data="Busdiv2#SystemBusClock/2"            />
      <choice value="2" name="Alternate clock (OSCERCLK)"  data="OscerClk#Osc0Info::getOscerClock()"  />
      <choice value="3" name="Asynchronous clock (ADACK)"  data="Asynch#2000000"                      isDefault="true" />
   </choiceOption>
   
   <category name="SOPT1" description="RTC clocks" >

      <aliasOption key="rtc_clkin_clock" constant="false" />

      <aliasOption key="sim_sopt1_osc32ksel" constant="false" />
      <aliasOption key="system_erclk32k_clock" />
      
   </category>

   <category name="SOPT2" description="Clock Gating">
   
      <template><![CDATA[
         \t/**
         \t * Get Peripheral clock frequency
         \t *
         \t * @return Frequency as a uint32_t in Hz
         \t *
         \t * @note If there is a peripheral clock divider then this is the 
         \t *       frequency of the undivided peripheral clock
         \t */
         \tstatic uint32_t getPeripheralClock() {
         \t      
         \t   return SystemMcgFllClock;
         \t}\n\n
      ]]></template>
   
      <aliasOption key="/SIM/sim_sopt2_rtcclkoutsel" constant="false"/>
      <aliasOption key="/SIM/rtc_clkout" />
      <aliasOption key="/SIM/system_peripheral_clock[]" optional="true" />
      <aliasOption key="/OSC0/oscer_clock" optional="true" />
      <aliasOption key="/MCG/system_mcgirclk_clock[]" optional="true" />
      
      <choiceOption name="sim_sopt2_uart0src" 
         description="UART0 Clock"
         toolTip="Clock source for the transmit and receive clock">
         <choice value="0"  name="Disabled"           data="Disabled#0"                         />
         <choice value="1"  name="MCGFLLCLK clock"    data="McgFllClk#SystemMcgFllClock"        isDefault="true" />
         <choice value="2"  name="OSCERCLK clock"     data="OscerClk#Osc0Info::getOscerClock()" />
         <choice value="3"  name="MCGIRCLK clock"     data="McgIrClk#McgInfo::getMcgIrClock()"  />
      </choiceOption>
      
      <intOption name="system_uart0_clock" 
         constant="true"
         derived="true"
         units="Hz"
         description="UART0 Clock frequency"
         toolTip="Frequency of clock to UART"
         value="0" />
      
      <choiceOption name="sim_sopt2_tpmsrc"
         description="TPM Clock"
         toolTip="Clock source for the timer clock">
         <choice value="0"  name="Disabled"           data="Disabled#0"                         />
         <choice value="1"  name="MCGFLL Clock"       data="McgFllClk#SystemMcgFllClock"        isDefault="true" />
         <choice value="2"  name="OSCERCLK clock"     data="OscerClk#Osc0Info::getOscerClock()" />
         <choice value="3"  name="MCGIRCLK clock"     data="McgIrClk#McgInfo::getMcgIrClock()"  />
      </choiceOption>
      
      <intOption name="system_tpm_clock"
         derived="true" 
         constant="true"
         units="Hz"
         description="TPM Clock frequency"
         toolTip="Frequency of clock to TPM"
         value="0" />
      
      <choiceOption name="sim_sopt2_clkoutsel" 
         description="CLKOUT pin clock"
         toolTip="Clock to output on the CLKOUT pin[]" >
         <choice value="2"  name="Bus clock"          data="Bus" isDefault="true" />
         <choice value="3"  name="LPO clock (1 kHz)"  data="Lpo"        />
         <choice value="4"  name="MCGIRCLK"           data="McgIrClk"   />
         <choice value="6"  name="OSCERCLK0"          data="OscerClk0"   />
      </choiceOption>
      
   </category>
   
   <category name="SOPT4" description="TPM signals">
      <binaryOption name="sim_sopt4_tpm0clksel" 
         description="TPM 0 External Clock Pin "
         toolTip="External pin used to drive the clock to the TPM module">
         <choice value="0"  name="TPM_CLKIN0 pin" data="0" isDefault="true" />
         <choice value="1"  name="TPM_CLKIN1 pin" data="1" />
      </binaryOption>
      
      <binaryOption name="sim_sopt4_tpm1clksel" 
         description="TPM 1 External Clock Pin"
         toolTip="External pin used to drive the clock to the TPM module">
         <choice value="0"  name="TPM_CLKIN0 pin" data="0" isDefault="true" />
         <choice value="1"  name="TPM_CLKIN1 pin" data="1" />
      </binaryOption>
      
      <binaryOption name="sim_sopt4_tpm1ch0src" 
         description="TPM 1 channel 0 input capture source"
         toolTip="Source for TPM channel 0 input capture\n
            NOTE: When the TPM is not in input capture mode, clear this field">
         <choice value="0" name="TPM1_CH0 signal"           data="IcPin"  isDefault="true"/>
         <choice value="1" name="CMP0 output"               data="Cmp0"   />
      </binaryOption>   
      
   </category>
   
   <category name="SOPT5" description="UART signals">
      <binaryOption name="sim_sopt5_uart0ode"  
         description="UART0 Open Drain"
         toolTip="Enables Open Drain output">
         <choice value="0" name="Push-pull"  data="PushPull"   />
         <choice value="1" name="Open-drain" data="OpenDrain"  />
      </binaryOption>
      
      <choiceOption name="sim_sopt5_uart0rxsrc" 
         description="UART 0 receive data source"
         toolTip="Selects the source for the UART receive data">
         <choice value="0" name="UART0_RX pin"    data="Uart0Rx"  isDefault="true" />
         <choice value="1" name="CMP0 output"     data="Cmp0" />
      </choiceOption>
      
      <choiceOption name="sim_sopt5_uart0txsrc" 
         description="UART 0 transmit data source"
         toolTip="Selects the source for the UART transmit data">
         <choice value="0" name="UART0_TX pin" isDefault="true"                      data="Direct" />
         <choice value="1" name="UART0_TX pin modulated with TPM1 channel 0 output"  data="ModulatedByTpm1Ch0" />
         <choice value="2" name="UART0_TX pin modulated with TPM2 channel 0 output"  data="ModulatedByTpm2Ch0" />
      </choiceOption>
      
   </category>

   <category name="SOPT7" description="ADC signals">
      <choiceOption name="sim_sopt7_adc0trigger" 
         description="ADC0 trigger mode"
         toolTip="Alternative conversion triggers for ADC0\n
            _Tpm              - ADC is triggered by TPM. Pre-triggers are TPM channel 0 (A) and channel 1 (B)\n
            _Alt_PreTrigger_0 - ADC is triggered by SimAdc0Trigger selection and uses pretrigger 0 = A (SC1[0]/R[0])\n
            _Alt_PreTrigger_1 - ADC is triggered by SimAdc0Trigger selection and uses pretrigger 1 = B (SC1[1]/R[1])" >
         <choice value="SIM_SOPT7_ADC0ALTTRGEN(0)"                            
         name="Triggered by TPM Ch0 and Ch1"  data="Tpm"  isDefault="true" />
         <choice value="SIM_SOPT7_ADC0ALTTRGEN(1)|SIM_SOPT7_ADC0PRETRGSEL(0)" 
         name="Pre-trigger 0 = A (SC1[0])"             data="Alt_PreTrigger_0" />
         <choice value="SIM_SOPT7_ADC0ALTTRGEN(1)|SIM_SOPT7_ADC0PRETRGSEL(1)" 
         name="Pre-trigger 1 = B (SC1[1])"             data="Alt_PreTrigger_1" />
      </choiceOption>
      
      <choiceOption name="sim_sopt7_adc0trgsel"
         description="ADC0 trigger"
         toolTip="Trigger source when alternative triggers are functional in stop and VLPS modes">
         <choice value="0"  name="External trigger pin input (EXTRG_IN)" data="External" isDefault="true" />
         <choice value="1"  name="CMP 0 output"                          data="Cmp0"       />
         <choice value="4"  name="PIT trigger 0"                         data="PitCh0"     />
         <choice value="5"  name="PIT trigger 1"                         data="PitCh1"     />
         <choice value="8"  name="TPM0 trigger"                          data="Tpm0"       />
         <choice value="9"  name="TPM1 trigger"                          data="Tpm1"       />
         <choice value="10" name="TPM2 trigger"                          data="Tpm2"       />
         <choice value="12" name="RTC alarm"                             data="RtcAlarm"   />
         <choice value="13" name="RTC seconds"                           data="RtcSeconds" />
         <choice value="14" name="LPTMR trigger"                         data="Lptmr"      />
      </choiceOption>
      
   </category>
    
   <xi:include href="_simCommon.xml"/>

   <indexedCategory name="ClockConfig[]" dim="/SIM/numberOfClockSettings" 
        derived="true"
        constant="true"
        value=""
        description="Clock configurations" 
        toolTip="Clock configurations for different run modes" >
      
      <aliasOption key="/MCG/ClockConfig[]" constant="true"/>
      
      <intOption name="system_peripheral_clock[]"
         derived="true"
         constant="true"
         units="Hz"
         description="Peripheral Clock frequency"
         toolTip="Frequency of Peripheral Clock available to various peripherals"  />
	 
      <intOption name="system_core_clock[]" 
         units="Hz"
         description="System Core Clock"
         toolTip="Clocks the ARM Cortex-M4 core and bus masters"
         value="48 MHz" />
      
      <intOption name="system_bus_clock[]" 
         units="Hz"
         description="System Bus Clock"
         toolTip="Clocks the bus slaves and peripherals\n
                  Must be &lt;= Core Clock frequency"
         value="24 MHz" />
      
      <category name="CLKDIV1" description="System Clock Dividers">
         <intOption name="sim_clkdiv1_outdiv1[]" 
            derived="true"
            constant="true"
            description="Core &amp; System Clock Divider (OUTDIV1) - Divide by [1-16]"
            toolTip="Clocks the ARM Cortex-M4 core and bus masters [SIM_CLKDIV1_OUTDIV1]\n
                     Divides MCGOUT Clock to generate system_core_clock"
            value="1" offset="-1" min="1" max="16" />
         
         <intOption name="sim_clkdiv1_outdiv4[]" 
            derived="true"
            constant="true"
            description="Flash Clock Divider (OUTDIV4) - Divide by [1-16]"
            toolTip="Clocks the flash memory [SIM_CLKDIV1_OUTDIV4]\n
                     Divides MCGOUT Clock to generate system_flash_clock\n
                     MCGOUTCLK clock is source. Default /4"
            value="4" offset="-1" min="1" max="16" />
      </category>
   </indexedCategory>
   
   <template><![CDATA[
      \t/**
      \t * Update system clock values
      \t *
      \t * @param systemClock Frequency of clock provided to system clock dividers
      \t */
      \tstatic void updateSystemClocks(unsigned systemClock) {
      \t
      \t   SystemCoreClock    = systemClock/(((SIM->CLKDIV1&SIM_CLKDIV1_OUTDIV1_MASK)>>SIM_CLKDIV1_OUTDIV1_SHIFT)+1);
      \t   SystemBusClock     = SystemCoreClock/(((SIM->CLKDIV1&SIM_CLKDIV1_OUTDIV4_MASK)>>SIM_CLKDIV1_OUTDIV4_SHIFT)+1);
      \t}\n\n
   ]]></template>

   <xi:include href="_sim_commonTemplates.xml" />

   <validate
      class="net.sourceforge.usbdm.deviceEditor.validators.SimValidateMKL" dim="/SIM/numberOfClockSettings">
      <param type="long" value="48MHz" />    <!-- Core         -->
      <param type="long" value="24MHz" />    <!-- Bus          -->
   </validate>
   
   <xi:include href="_simFiles-MKL.xml"/>
   
</peripheralPage>
