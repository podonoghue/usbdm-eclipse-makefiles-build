<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE peripheralPage SYSTEM "_menu.dtd" >
<!-- ics_mke.xml -->

<peripheralPage xmlns:xi="http://www.w3.org/2001/XInclude" name="_instance" description="Internal clock source" >

   <equation key="irq_parameters"             value=""          />
   <equation key="irq_dummy_parameters"       value=""          />
   <equation key="irq_call"                   value=""          />
   <equation key="generateDefault"            value="false"     />
   <equation key="configureInStartupDefault"  value="false"     />
   <xi:include href="enablePeripheral.xml"    />
   <title />

   <!-- Clock mode as indicated by icsClockMode[%(n)] choice index -->
   <constant key="FEI"   value="0" type="Long" />
   <constant key="FEE"   value="1" type="Long" />
   <constant key="FBI"   value="2" type="Long" />
   <constant key="FBE"   value="3" type="Long" />
   <constant key="FBILP" value="4" type="Long" />
   <constant key="FBELP" value="5" type="Long" />


   <!-- ____ Class Declaration ________ -->
   <constant key="_class_declaration" type="String" value='"$(_Info) : public $(_BasicInfo)"' />

   <clockSelectionOption key="currentClockConfig"
      derived="true"
      description="Active clock selection"
      toolTip="Selects the clock configuration used for general peripheral timing calculations" >
      <choice value="0" name="@ClockConfig[0]" ref='"0: "+ClockConfig[0]' isDefault="true" />
      <choice value="1" name="@ClockConfig[1]" ref='"1: "+ClockConfig[1]' />
      <choice value="2" name="@ClockConfig[2]" ref='"2: "+ClockConfig[2]' />
      <choice value="3" name="@ClockConfig[3]" ref='"3: "+ClockConfig[3]' />
   </clockSelectionOption>

   <aliasOption key="/SIM/numberOfClockSettings" />

   <binaryOption key="enableClockChangeNotifications"
      enabledBy="enablePeripheralSupport"
      description="Enables adding clock change call-backs"
      toolTip="Call-backs provide notification before and after clock settings are changed" >
      <choice value="false" name="Disabled" isDefault="true" />
      <choice value="true"  name="Call-backs may be installed"  />
   </binaryOption>

   <binaryOption key="enableClockConfiguration[0]"
      locked="true"
      hidden="true"
      enabledBy="enablePeripheralSupport" >
      <choice value="false" name="Disabled" />
      <choice value="true"  name="Enabled"  isDefault="true" />
   </binaryOption>

   <for keys="n" dim="=1,(/SIM/numberOfClockSettings-1)" >
      <binaryOption key="enableClockConfiguration[%(n)]"
         enabledBy="enablePeripheralSupport"
         hidden="true"
         description="Enable this clock settings"
         toolTip="If disabled this clock setting will be removed from the generated code" >
         <choice value="false" name="Disabled" isDefault="true" />
         <choice value="true"  name="Enabled" />
      </binaryOption>
   </for>

   <binaryOption key="assumeSlowIrcTrimmed"
      enabledBy="!enablePeripheralSupport"
      description="Assume slow IRC trimmed in minimal configuration"
      toolTip="Used to indicate that the Slow Internal Reference clock has been trimmed and\n
               hence it is safe to use higher clock frequencies derived from the IRC\n
               without danger of exceeding the maximim clock frequency.\n
               Only used in minimal configuration"
      >
      <choice value="false" name="Clock is not trimmed" />
      <choice value="true"  name="Clock is trimmed"     />
   </binaryOption>

   <intOption key="icsirclk"
      locked="true"
      derived="true"
      hidden="true"
      units="Hz"
      description="ICS Internal Reference Clock [ICSIRC]"
      toolTip="Dependent on device and clock Trim. [Nominally 37.5 kHz]"
      value="37.5_kHz" />

   <for keys="n" dim="=/SIM/numberOfClockSettings" >
      <categoryOption key="ClockConfig[%(n)]"
         enabledBy="enablePeripheralSupport&amp;&amp;enableClockConfiguration[%(n)]"
         description="Clock configuration[%(n)]"
         toolTip="Clock configurations for different run modes"
         value="ClockConfig_%(n)"
         disabledValue="=(%(n)==0)?&quot;Reset Configuration&quot;:&quot;Disabled&quot;" >

         <if condition="%(n)==0" >
            <aliasOption key="enableClockConfiguration[%(n)]" />
         <else/>
            <aliasOption key="enableClockConfiguration[%(n)]" locked="false" />
         </if>

         <graphic key="Clock configuration GUI[%(n)]"
            var="ClockConfig[%(n)]"
            description="Clock configuration[%(n)]"
            clockConfigIndex="%(n)"
            toolTip="Opens a dialogue to alter this clock configuration" >

            <graphicBox id="" x="10" y="10" params="0,0, x340, y50, x" >
               <graphicItem id="ICS CLOCK MODE" var="icsClockMode[%(n)]" type="variableBox" params="170, 25,  300, large"                          />
            </graphicBox>

            <graphicBox id="ICS" x="10" y="70" params="0,0,   x570, y360,  x" >
               <!-- ICSIRCLK -->
               <graphicItem id="ICS_IRC"                   var="icsirclk"     type="variableBox" params="50,  55,  80, large"               />
               <graphicItem id=""                          var="icsirclk"     type="connector"   params="ICS_IRC,0, ICSIRCLKEN,0"           />
               <graphicItem id="ICSIRCLKEN,x-20"           var="ics_c1_irclken[%(n)]"        type="node"        params="495, 55"                           />
               <graphicItem id=""                          var="system_icsirclk_clock[%(n)]" type="connector"   params="ICSIRCLKEN,0, ICSIRCLK.1,0"        />
               <graphicItem id="ICSIRCLK.1,NONAME"         var="system_icsirclk_clock[%(n)]" type="node"        params="570, 55"                           />

               <graphicItem id="RDIV"                      var="ics_c1_rdiv[%(n)]"           type="choice"      params="75, 165, 85, large"                />
               <graphicItem id="RANGE,NONAME"              var="/OSC0/osc_cr_range"          type="annotation"  params="30, 185, 100, 20"                  />
               <graphicItem id="RDIV_OUT,NONAME"           var="ics_erc_clock_divided[%(n)]" type="annotation"  params="30, 200, 100, 20, Fout=%v"         />
               <graphicItem id=""                          var="ics_erc_clock_divided[%(n)]" type="connector"   params="RDIV,0,     IREFS,0"               />
               <graphicItem id=""                          var=""                            type="connector"   params="ICS_IRC,0, IREFS,1, (x-20),d,y,x"  />

               <!-- IREFS => FLL/ICSFFCLK -->
               <graphicItem id="IREFS"                     var="ics_c1_irefs[%(n)]"                 type="mux"         params="165, 155, 2, mirror"               />
               <graphicItem id=""                          var="system_icsffclk_clock[%(n)]"        type="connector"   params="IREFS,0, ICSFFCLK.1,0, x45,d,y,x"  />
               <graphicItem id="ICSFFCLK_A1,NONAME"        var="system_icsffclk_clock[%(n)]"        type="annotation"  params="300, 85, 70, 20"                   />
               <graphicItem id="ICSFFCLK.1,NONAME"         var="system_icsffclk_clock[%(n)]"        type="node"        params="570, 105"                          />
               <graphicItem id=""                          var="system_icsffclk_clock[%(n)]"        type="connector"   params="IREFS,0, FLL,0"                    />
               <graphicItem id="FLL"                       var="system_icsfllclk_clock[%(n)]"       type="variableBox" params="285, 155, 80,  large"              />
               <graphicItem id="FLLINPUT,NONAME"           var="fllInputFrequency[%(n)]"            type="annotation"  params="245, 180, 100, 18, Fin=%v"         />
               <graphicItem id=""                          var=""                                   type="connector"   params="FLL,0,  ICSFLLCLK.1,0, x20,d,y,x"  />
               <graphicItem id="ICSFLLCLK.1,NONAME"        var="system_icsfllclk_clock[%(n)]"       type="node"        params="570, 155"                          />

               <!-- FLL => CLKS => BDIV => ICSOUTCLK -->
               <graphicItem id=""                          var="system_icsfllclk_clock[%(n)]"       type="connector"   params="FLL,0,  CLKS,0, x20,y,x"           />
               <graphicItem id=""                          var="icsirclk"            type="connector"   params="ICS_IRC,0, CLKS,1, (x-20),d,y,x"   />
               <graphicItem id="CLKS"                      var="ics_c1_clks[%(n)]"                  type="mux"         params="400, 205, 3"                       />
               <graphicItem id=""                          var="system_icsoutclk_clock[%(n)]"       type="connector"   params="CLKS,0, BDIV,0"                    />
               <graphicItem id="BDIV"                      var="ics_c2_bdiv[%(n)]"                  type="variableBox" params="480, 205, 95, large"               />
               <graphicItem id=""                          var="system_icsoutclk_clock[%(n)]"       type="connector"   params="BDIV,0, ICSOUTCLK,0"               />
               <graphicItem id="ICSOUTCLK"                 var="system_icsoutclk_clock[%(n)]"       type="node"        params="570, 205"                          />

               <graphicGroup x="0" y="0" condition="!ics_c7_oscsel_present" >
                  <!-- ICSERCLK => RDIV/PLL/CLKS   (no OSCSEL) -->
                  <graphicItem id="ICSERCLK_IN_IN0,NONAME,NOVALUE"    var="ics_erc_clock[%(n)]"     type="node"        params="410, 360, is,on"                   />

                  <graphicItem id="ICSERCLK_C_CLKS"   var="ics_erc_clock[%(n)]"  type="connector"   params="ICSERCLK_IN_IN0,0,  CLKS,2, y-20,(x-20),d,y,x"   />
                  <graphicItem id="ICSERCLK_C_RDIV"   var="ics_erc_clock[%(n)]"  type="connector"   params="ICSERCLK_IN_IN0,0,  RDIV,0, y-20,(x-15),y,x"     />
                  <graphicItem id="ICSERCLK"          var="ics_erc_clock[%(n)]"  type="annotation"  params="220, 315, 70, 20"                                />
               </graphicGroup>

               <!-- ICS OSCSEL Input -->
               <graphicItem id="OSCCLK_C_OSCSEL0"     type="connector"   params="OSCERCLK.1 ,0,   ICSERCLK_IN_IN0,0, x,d,y"  />
            </graphicBox>

            <equation key="y" value="=450" />

            <graphicBox    id="OSC0" x="10" y="y"  params="0,0, x280, y140,  x" >
               <graphicItem id="FREQ"           var="/OSC0/osc_input_freq"   type="variableBox" params="50,  30,  80, large, oe,os+30"  />

               <graphicItem id="MODE,NONAME"    var="/OSC0/osc_cr_oscMode"   type="annotation"  params="10,  55, 180, 16"               />
               <graphicItem id="RANGE,NONAME"   var="/OSC0/osc_cr_range"     type="annotation"  params="10,  75, 180, 16"               />
               <graphicItem id="OSCEN,NONAME"   var="/OSC0/osc_cr_oscen"     type="annotation"  params="10,  95, 180, 16"               />
               <graphicItem id="OSCSTEN,NONAME" var="/OSC0/osc_cr_oscsten"   type="annotation"  params="10,  115, 140, 20"              />

               <!-- Outputs -->
               <graphicItem id="OSCERCLK.1 "       var="/OSC0/oscer_clock"      type="node"        params="280, 30"                     />

               <graphicItem id=""               var="/OSC0/oscer_clock"      type="connector"   params="FREQ,0,   OSCERCLK.1 ,0"        />

               <equation key="y" value="=y+160" />
            </graphicBox>

            <graphicBox    id="RTC" x="10" y="y" params="0,0, x280, y175,  x" >
               <!-- Source connections -->
               <graphicItem id=""    var="/OSC0/oscer_clock"             type="connector"   params="OSCERCLK.1,0,    RTC_IN0,0, (x+20),d,y,x"  />
               <graphicItem id=""    var="/PMC/system_low_power_clock"   type="connector"   params="LPO.1,0,         RTC_IN1,0, x120,y,d,x"    />
               <graphicItem id=""    var=""                              type="connector"   params="ICSIRCLK.2,0,    RTC_IN2,0, x-20,y,x"      />
               <graphicItem id=""    var=""                              type="connector"   params="BUS_CLK.2,0,     RTC_IN3,0, x-20,y,x"      />

               <!-- Inputs & mux -->
               <graphicItem id="RTC_IN0,NONAME,NOVALUE" var="/OSC0/oscer_clock"               type="node"  params="280,  40, ie,ow"  />
               <graphicItem id="RTC_IN1,NONAME,NOVALUE" var="/PMC/system_low_power_clock"     type="node"  params="280,  60, ie,ow"  />
               <graphicItem id="RTC_IN2,NONAME,NOVALUE" var="/ICS/icsirclk"    type="node"  params="280,  80, ie,ow"  />
               <graphicItem id="RTC_IN3,NONAME,NOVALUE" var="/SIM/system_bus_clock[0]"        type="node"  params="280, 100, ie,ow"  />
               <graphicItem id=""  type="connector"   params="RTC_IN0,0,   RTCCLKS,0, x-20,y "   />
               <graphicItem id=""  type="connector"   params="RTC_IN1,0,   RTCCLKS,1, x-20,y "   />
               <graphicItem id=""  type="connector"   params="RTC_IN2,0,   RTCCLKS,2, x-20,y "   />
               <graphicItem id=""  type="connector"   params="RTC_IN3,0,   RTCCLKS,3, x-20,y "   />
               <graphicItem id="RTCCLKS"        var="/RTC/rtc_sc_rtclks"    type="mux"        params="235, 70, 4, rot180mirror"   />

               <graphicItem id=""         var="/RTC/rtc_input_clock"  type="connector"   params="RTCCLKS,0,   PRES,0, x-20,y,y"   />

               <graphicItem id="Fi.0,NONAME" var="/RTC/rtc_input_clock"  type="annotation"  params="150, 35, 160, 20"                />
               <graphicItem id="PRES"        var="/RTC/rtc_sc_rtcps"     type="variableBox" params="80,  55, 110, large, ie, os+50"  />
               <graphicItem id="Fo.0"        var="/RTC/rtc_clock"        type="annotation"  params="30,  80, 160, 20"                />

               <graphicItem id=""         var="/RTC/rtc_input_clock"  type="connector"   params="PRES,0,   MOD,0, "               />
               <graphicItem id="MOD"      var="/RTC/rtc_mod_mod"      type="variableBox" params="80,  125, 110, large, in+50"     />
               <graphicItem id="Period.0" var="/RTC/rtc_period"       type="annotation"  params="30,  150, 160, 20"               />

               <graphicItem id=""         var="/RTC/rtc_period"       type="connector"   params="MOD,0,   Enable.1,0, x.2,y,x"           />
               <graphicItem id="Enable.1" var="/RTC/rtc_sc_rtco"      type="node"        params="225, 150, iw, oe"                />

               <graphicItem id=""         var="/RTC/rtc_out"       type="connector"   params="Enable.1,0,   RTO.1,0, x0.5,y,x"         />
               <graphicItem id="RTO.1"    var="/RTC/rtc_out"       type="node"        params="280, 150"                           />

               <equation key="y" value="=y+195" />
            </graphicBox>

            <graphicBox    id="PMC" x="10" y="y" params="0,0, x280, y60,  x" >
               <graphicItem id="LPO_OSC"      var="/PMC/system_low_power_clock"        type="variableBox" params="50,  30,  80, large"        />
               <graphicItem id=""             var=""                                   type="connector"   params="LPO_OSC,0,    LPO.1,0"      />

               <!-- Outputs -->
               <graphicItem id="LPO.1"        var="/PMC/system_low_power_clock"        type="node"        params="280, 30"                    />
               <equation key="y" value="=y+80" />
            </graphicBox>

            <!-- TCLKn -->
            <graphicGroup x="10" y="y" condition="/SIM/sim_pinsel_ftm0clkps_present||/SIM/sim_pinsel0_ftm0clkps_present" >
               <graphicItem id="TCLK0.0,x-20,y+16"   type="node"        params="330, 10" />
               <graphicItem id="TCLK1.0,x-20,y+16"   type="node"        params="330, 30" />
               <graphicItem id="TCLK2.0,x-20,y+16"   type="node"        params="330, 50" condition="/SIM/sim_pinsel0_pwtclkps_present"  />

               <equation key="y" value="=y+10" />
            </graphicGroup>

            <graphicBox    id="SIM" x="290" y="70" params="290,0, x360, y1640, x-600, y-1280, x" >

               <!-- MGCIRCLK -->
               <graphicItem id=""             var=""                                   type="connector"   params="ICSIRCLK.1,0, ICSIRCLK,0"   />
               <graphicItem id="ICSIRCLK"     var="system_icsirclk_clock[%(n)]"        type="node"        params="650, 55"                    />

               <!-- ICSFFCLK -->
               <graphicItem id=""             var=""                                   type="connector"   params="ICSFFCLK.1,0, ICSFFCLK,0"   />
               <graphicItem id="ICSFFCLK"     var="system_icsffclk_clock[%(n)]"        type="node"        params="650, 105"                   />

               <!-- ICSFFLCLK -->
               <graphicItem id=""             var=""                                   type="connector"   params="ICSFLLCLK.1,0, ICSFLLCLK,0"   />
               <graphicItem id="ICSFLLCLK"    var="system_icsfllclk_clock[%(n)]"       type="node"        params="650, 155"                  />

               <!-- CORE, BUS, FLEXBUS, FLASH -->
               <graphicItem id=""         type="connector"   params="ICSOUTCLK,0, OUTDIV1,0, (x-50),y"               />
               <graphicItem id=""         type="connector"   params="OUTDIV1,0,   OUTDIV2,0, x20,d,y.5,x,(x-20),y,x" />
               <graphicItem id=""         type="connector"   params="ICSOUTCLK,0, OUTDIV3,0, (x-50),d,y"           />

               <graphicItem id="OUTDIV1"  var="/SIM/sim_clkdiv_outdiv1[%(n)]"  type="choice" params="500, 205, 100, large" />
               <graphicItem id="OUTDIV2"  var="/SIM/sim_clkdiv_outdiv2[%(n)]"  type="choice" params="500, 265, 100, large" />
               <graphicItem id="OUTDIV3"  var="/SIM/sim_clkdiv_outdiv3[%(n)]"  type="choice" params="500, 325, 100, large" />

               <graphicItem id="CORE_CLK.C"                var="/SIM/system_core_clock[%(n)]"       type="connector"   params="OUTDIV1,0, CORE_CLK,0"   />
               <graphicItem id="BUS_CLK.C"                 var="/SIM/system_bus_clock[%(n)]"        type="connector"   params="OUTDIV2,0, BUS_CLK,0"    />
               <graphicItem id="TIMER_CLK.C"               var="/SIM/system_timer_clock[%(n)]"      type="connector"   params="OUTDIV3,0, TIMER_CLK,0"  />

               <graphicItem id="CORE_CLK"      edit="true" var="/SIM/system_core_clock[%(n)]"       type="node"        params="650, 205"                />
               <graphicItem id="BUS_CLK"       edit="true" var="/SIM/system_bus_clock[%(n)]"        type="node"        params="650, 265"                />
               <graphicItem id="TIMER_CLK"     edit="true" var="/SIM/system_timer_clock[%(n)]"      type="node"        params="650, 325"                />

               <equation key="y" value="=410" />

               <!-- OSCERCLK -->
               <graphicGroup x="0" y="y" >
                  <graphicItem id=""                  var=""                   type="connector"   params="OSCERCLK.1,0,  OSCERCLK,0" />
                  <graphicItem id="OSCERCLK"          var="/OSC0/oscer_clock"  type="node"        params="650, 0"                    />

                  <equation key="y" value="=y+40" />
               </graphicGroup>

               <!-- RTC -->
               <graphicGroup x="0" y="y" >
                  <graphicItem id=""                  var=""                   type="connector"   params="RTO.1,0,    RTC_OUT,0, x100,y,x"  />
                  <graphicItem id="RTC_OUT"           var="/RTC/rtc_out"       type="node"        params="650, 0"                           />

                  <equation key="y" value="=y+50" />
               </graphicGroup>

               <!-- LPO -->
               <graphicGroup x="0" y="y" >
                  <graphicItem id=""                  var=""                             type="connector"   params="LPO.1,0,    LPO,0, x120,y,x"  />
                  <graphicItem id="LPO"               var="/PMC/system_low_power_clock"  type="node"        params="650, 0"                       />

                  <equation key="y" value="=y+50" />
               </graphicGroup>

               <graphicGroup x="0" y="y" >
                  <graphicItem id="ICSIRCLK.2"     var="/ICS/system_icsirclk_clock[%(n)]" type="reference"   params="230,  70, 130, ow"  />
                  <graphicItem id="BUS_CLK.2"      var="/SIM/system_bus_clock[%(n)]"      type="reference"   params="230,  90, 130, ow"  />
               </graphicGroup>

               <!-- UART0_FIXED_SRC -->
               <graphicGroup x="0" y="y" condition="/SIM/system_uart0_fixedclocksource[%(n)]" >
                  <graphicItem id="UART0_CLKSRC"            var="/SIM/system_uart0_fixedclocksource[%(n)]" type="reference"   params="370,  -10, 110"                />
                  <graphicItem id=""                        var=""                                         type="connector"   params="UART0_CLKSRC,0,  UART0_CLK,0"  />
                  <graphicItem id="UART0_CLK"               var="/SIM/system_uart0_clock[%(n)]"            type="node"        params="650,  -10"                     />
                  <equation key="y" value="=y+40" />
               </graphicGroup>

               <!-- UART1_FIXED_SRC -->
               <graphicGroup x="0" y="y" condition="/SIM/system_uart1_fixedclocksource[%(n)]" >
                  <graphicItem id="UART1_CLKSRC"            var="/SIM/system_uart1_fixedclocksource[%(n)]" type="reference"   params="370,  -10, 110"                />
                  <graphicItem id=""                        var=""                                         type="connector"   params="UART1_CLKSRC,0,  UART1_CLK,0"  />
                  <graphicItem id="UART1_CLK"               var="/SIM/system_uart1_clock[%(n)]"            type="node"        params="650,  -10"                     />
                  <equation key="y" value="=y+40" />
               </graphicGroup>

               <!-- UART2_FIXED_SRC -->
               <graphicGroup x="0" y="y" condition="/SIM/system_uart2_fixedclocksource[%(n)]" >
                  <graphicItem id="UART2_CLKSRC"            var="/SIM/system_uart2_fixedclocksource[%(n)]" type="reference"   params="370,  -10, 110"                />
                  <graphicItem id=""                        var=""                                         type="connector"   params="UART2_CLKSRC,0,  UART2_CLK,0"  />
                  <graphicItem id="UART2_CLK"               var="/SIM/system_uart2_clock[%(n)]"            type="node"        params="650,  -10"                     />

                  <equation key="y" value="=y+40" />
               </graphicGroup>

               <!-- TCLKn -->
               <graphicGroup x="0" y="y" condition="/SIM/sim_pinsel0_ftm0clkps_present" >
                  <graphicItem id=""             type="connector"   params="TCLK0.0,0, FTM0CLKPS,0, x.7,d,y,x"                          />
                  <graphicItem id=""             type="connector"   params="TCLK1.0,0, FTM0CLKPS,1, x.8,d,y,x"                          />
                  <graphicItem id=""             type="connector"   params="TCLK2.0,0, FTM0CLKPS,2, x.9,d,y,x"                          />
                  <graphicItem id="FTM0CLKPS" type="mux"         params="500, 30, 3"                 var="/SIM/sim_pinsel0_ftm0clkps"   />
                  <graphicItem id=""             type="connector"   params="FTM0CLKPS,0, FTM_CLK0,0"                                    />
                  <graphicItem id="FTM_CLK0"  type="node"        params="650, 30"                                                       />

                  <equation key="y" value="=y+100" />
               </graphicGroup>
               <for keys="v" values="1;2;3;4" >
                  <graphicGroup x="0" y="y" condition="/SIM/sim_pinsel0_ftm%(v)clkps_present" >
                     <graphicItem id=""             type="connector"   params="TCLK0.0,0, FTM%(v)CLKPS,0, x.7,d,y,d,x"                          />
                     <graphicItem id=""             type="connector"   params="TCLK1.0,0, FTM%(v)CLKPS,1, x.8,d,y,d,x"                          />
                     <graphicItem id=""             type="connector"   params="TCLK2.0,0, FTM%(v)CLKPS,2, x.9,d,y,d,x"                          />
                     <graphicItem id="FTM%(v)CLKPS" type="mux"         params="500, 30, 3"                 var="/SIM/sim_pinsel0_ftm%(v)clkps"  />
                     <graphicItem id=""             type="connector"   params="FTM%(v)CLKPS,0, FTM_CLK%(v),0"                                   />
                     <graphicItem id="FTM_CLK%(v)"  type="node"        params="650, 30"                                                         />

                     <equation key="y" value="=y+100" />
                  </graphicGroup>
               </for>
               <graphicGroup x="0" y="y" condition="/SIM/sim_pinsel0_pwtclkps_present" >
                  <graphicItem id=""             type="connector"   params="TCLK0.0,0, PWTCLKPS,0, x.7,d,y,x"                      />
                  <graphicItem id=""             type="connector"   params="TCLK1.0,0, PWTCLKPS,1, x.8,d,y,x"                      />
                  <graphicItem id=""             type="connector"   params="TCLK2.0,0, PWTCLKPS,2, x.9,d,y,x"                      />
                  <graphicItem id="PWTCLKPS"     type="mux"         params="500, 30, 3"           var="/SIM/sim_pinsel0_pwtclkps"  />
                  <graphicItem id=""             type="connector"   params="PWTCLKPS,0, PWT_CLK,0"                                 />
                  <graphicItem id="PWT_CLK"      type="node"        params="650, 30"                                               />

                  <equation key="y" value="=y+100" />
               </graphicGroup>

               <!-- TCLKn -->
               <graphicGroup x="0" y="y" condition="/SIM/sim_pinsel_ftm0clkps_present" >
                  <equation key="y" value="=y+90" />
               </graphicGroup>
               <for keys="v" dim="3" >
                  <graphicGroup x="0" y="y" condition="/SIM/sim_pinsel_ftm%(v)clkps_present" >
                     <graphicItem id=""             type="connector"   params="TCLK0.0,0, FTM%(v)CLKPS,0, x.7,d,y,d,x"                          />
                     <graphicItem id=""             type="connector"   params="TCLK1.0,0, FTM%(v)CLKPS,1, x.8,d,y,d,x"                          />
                     <graphicItem id=""             type="connector"   params="TCLK2.0,0, FTM%(v)CLKPS,2, x.9,d,y,d,x"   condition="@/SIM/sim_pinsel_ftm%(v)clkps.size>2"           />
                     <graphicItem id="FTM%(v)CLKPS" type="mux"         params="500, 30, 3"                               var="/SIM/sim_pinsel_ftm%(v)clkps"   />
                     <graphicItem id=""             type="connector"   params="FTM%(v)CLKPS,0, FTM_CLK%(v),0"                                   />
                     <graphicItem id="FTM_CLK%(v)"  type="node"        params="650, 30"                                                         />

                     <equation key="y" value="=y+100" />
                  </graphicGroup>
               </for>
               <graphicGroup x="0" y="y" condition="/SIM/sim_pinsel_pwtclkps_present" >
                  <graphicItem id=""             type="connector"   params="TCLK0.0,0, PWTCLKPS,0, x.7,d,y,x"                      />
                  <graphicItem id=""             type="connector"   params="TCLK1.0,0, PWTCLKPS,1, x.8,d,y,x"                      />
                  <graphicItem id=""             type="connector"   params="TCLK2.0,0, PWTCLKPS,2, x.9,d,y,x"  condition="@/SIM/sim_pinsel_pwtclkps.size>2" />
                  <graphicItem id="PWTCLKPS"     type="mux"         params="500, 30, 3"                        var="/SIM/sim_pinsel_pwtclkps"  />
                  <graphicItem id=""             type="connector"   params="PWTCLKPS,0, PWT_CLK,0"                                 />
                  <graphicItem id="PWT_CLK"      type="node"        params="650, 30"                                               />

                  <equation key="y" value="=y+100" />
               </graphicGroup>
            </graphicBox>

         </graphic>

         <category name="OSC0 (Main Oscillator)" description="OSC External Reference Clock/Oscillator [OSCERCLK.1 ]" >
            <aliasOption key="/OSC0/osc_cr_oscMode"   />
            <aliasOption key="/OSC0/oscer_clock"      />
         </category>

         <category name="Internal Clocks" description="Internal Clock Sources"
            toolTip="ICSIRC, LPO" >
            <aliasOption key="icsirclk" />
            <aliasOption key="/PMC/system_low_power_clock" />
         </category>

         <choiceOption key="icsClockMode[%(n)]"
            enabledBy="enableClockConfiguration[%(n)]"
            typeName="IcsClockMode"
            baseType="uint8_t"
            valueFormat="%s"
            description="ICS Clock Mode"
            toolTip="Selects the basic clock mode for the Clock generator" >
            <choice name="FLL Engaged Internal (FEI)"               enum="FEI"   code="IcsClockMode_FEI"   value="0"
               toolTip="FLL Engaged Internal(FEI)\n
                     In FEI mode, ICSOUT is derived from the FLL clock (DCOCLK) that is controlled by the Internal Reference Clock (IRC).\n
                     The FLL loop will lock the DCO frequency to the FLL factor (1280) times the internal reference frequency."
            />
            <choice name="FLL Engaged External (FEE)"               enum="FEE"   code="IcsClockMode_FEE"   value="1"
               toolTip="FLL Engaged External(FEE)\n
                     In FEE mode, ICSOUT is derived from the FLL clock (DCOCLK) that is controlled by the external reference clock. The FLL loop\n
                     will lock the DCO frequency to the FLL factor (1280) times the external reference frequency, as specified by the C1[RDIV] and\n
                     OSC.C2[RANGE]."
            />
            <choice name="FLL bypassed internal (FBI)"              enum="FBI"   code="IcsClockMode_FBI"   value="2"
               toolTip="FLL Bypassed Internal(FBI)\n
                     In FBI mode, the ICSOUT clock is derived either from the internal reference clock,\n
                     as selected by the C2[IRCS] bit. The FLL is operational but its output is not used. This mode is useful to allow the FLL\n
                     to acquire its target frequency while the ICSOUT clock is driven from the C2[IRCS] selected internal reference clock. The\n
                     FLL clock (DCOCLK) is controlled by the internal reference clock, and the DCO clock frequency locks to a multiplication\n
                     factor (1280) times the internal reference frequency."
            />
            <choice name="FLL bypassed external (FBE)"              enum="FBE"   code="IcsClockMode_FBE"   value="4"
               toolTip="FLL Bypassed External(FBE)\n
                     In FBE mode, the ICSOUT clock is derived from the external reference clock. The FLL is operational but its output is not\n
                     used. This mode is useful to allow the FLL to acquire its target frequency while the ICSOUT clock is driven from the\n
                     external reference clock. The FLL clock (DCOCLK) is controlled by the external reference clock, and the DCO clock frequency\n
                     locks to a multiplication factor (1280) times the divided external reference\n
                     frequency."
            />
            <choice name="FLL bypassed low power internal (FBILP)"  enum="FBILP" code="IcsClockMode_FBILP" value="3"
               toolTip="FLL bypassed internal low power (FBILP)\n
                     In FBILP mode, ICSOUT is derived from the internal reference clock. The FLL is disabled."
            />
            <choice name="FLL bypassed low power external (FBELP)"  enum="FBELP" code="IcsClockMode_FBELP" value="5"
               toolTip="FLL bypassed external low power (FBELP)\n
                     In FBELP mode, ICSOUT is derived from the external reference clock. The FLL is disabled."
            />
         </choiceOption>

         <category name="Clock monitors"
            description="Clock monitors" >
            <binaryOption key="ics_c4_cme[%(n)]" condition="ics_c4_cme_present"
               enabledBy="enableClockConfiguration[%(n)]"
               typeName="IcsClockMonitor"
               description="Clock Monitor Enable"
               toolTip="Determines if a reset request is made following a loss of external clock indication.\n
                        The CME0 bit must only be when using an external clock mode (FEE, FBE, or FBELP)" >
               <choice value="0" enum="Disabled" name="Clock monitor disabled" />
               <choice value="1" enum="Enabled"  name="Clock monitor enabled"  />
            </binaryOption>

            <binaryOption key="ics_c4_lolie0[%(n)]" condition="ics_c4_lolie0_present"
               enabledBy="enableClockConfiguration[%(n)]"
               typeName="IcsLossOfLockInterrupt"
               description="Loss of Lock Interrupt Enable"
               toolTip="Determines if an interrupt request is made following a loss of lock.\n
                        This is indicated by ICS_S[LOLS] being set." >
               <choice name="Interrupt disabled"  value="0" enum="Disabled"/>
               <choice name="Interrupt enabled"   value="1" enum="Enabled"/>
            </binaryOption>

         </category>

         <category name="ICSIR" description="Internal Reference Clock Source [ICSIRCLK]" >

            <aliasOption key="icsirclk" />

            <binaryOption key="ics_c1_irclken[%(n)]" condition="ics_c1_irclken_present"
               enabledBy="enableClockConfiguration[%(n)]"
               typeName="IcsIrClkEn"
               target="system_icsirclk_clock[%(n)]"
               description="Internal Reference Clock [ICSIRCLK] enable"
               toolTip="Enables the internal reference clock for use by peripherals" >
               <choice value="0" ref="Disabled"                enum="Disabled" name="Disabled" code="0"                           />
               <choice value="1" ref="icsirclk" enum="Enabled"  name="Enabled"  code="icsirclk"    isDefault="true"/>
            </binaryOption>

            <binaryOption key="ics_c1_irefsten[%(n)]"
               typeName="IcsIrefs"
               enabledBy="ics_c1_irclken[%(n)]"
               description="Internal Reference [ICSIRCLK] Stop Enable"
               toolTip="Controls whether or not the internal reference clock remains enabled when the ICS enters Stop mode.\n
                        (only if IRCLKEN is set or if ICS is in FEI, FBI, or FBILP modes before entering Stop mode)" >
               <choice value="0" enum="DisabledInStop" name="IR disabled in STOP" />
               <choice value="1" enum="EnabledInStop"  name="IR enabled in STOP" />
            </binaryOption>

            <intOption key="system_icsirclk_clock[%(n)]"
               ref="icsirclk"
               enabledBy="ics_c1_irclken[%(n)]"
               locked="true"
               derived="true"
               units="Hz"
               description="ICS Internal Reference Clock [ICSIRC]"
               toolTip="Available to some peripherals if IRCLKEN is set. \n
                        Dependent on device and clock Trim. [Nominally 37.5 kHz]"
               disabledValue="0" />
         </category>

         <choiceOption key="ics_oscsel_fixed[%(n)]"
            target="ics_erc_clock[%(n)]"
            description="ICS External reference clock"
            toolTip="Source for ICS External Reference Clock" >
            <choice value="0" ref="/OSC0/oscer_clock" enum="OscClk" code="Osc0Info::getOscClock()"  name="OSC0 Clock" />
         </choiceOption>

         <intOption key="ics_erc_clock[%(n)]"
            locked="true"
            units="Hz"
            derived="true"
            description="Frequency of ICS External reference"
            toolTip="External reference clock used by ICS"
            value="0" />

         <category name="FLL" description="FLL Settings" >

            <binaryOption key="fll_enabled[%(n)]"
               enabledBy="((irefs_clock[%(n)]&gt;=31.25_kHz)&amp;&amp;(irefs_clock[%(n)]&lt;=39.0625_kHz))#irefs_clock[%(n)]"
               ref="(icsClockMode[%(n)]!=FBILP)&amp;&amp;(icsClockMode[%(n)]!=FBELP)"
               derived="true"
               locked="true"
               description="FLL State"
               toolTip="Determined from clock mode selected"
               disabledValue="0" >
               <choice value="0" name="FLL Inactive" />
               <choice value="1" name="FLL Active"   />
            </binaryOption>

            <aliasOption key="/OSC0/osc_cr_range"   optional="true"   />

            <choiceOption key="ics_c1_rdiv[%(n)]" condition="ics_c1_rdiv_present"
               enabledBy="enableClockConfiguration[%(n)]"
               target="ics_erc_clock_divided[%(n)]"
               typeName="IcsFllPrescale"
               derived="true"
               locked="true"
               description="FLL External Reference Divider"
               origin="Determined by FLL input frequency constraints and external reference clock frequency"
               toolTip="Selects the amount to divide down the external reference clock for the FLL.\n
                        The resulting frequency must be in [31.25 kHz to 39.0625 kHz] to be suitable for the FLL\n
                        Division factors choices depends on clock Range [OSC_C2_RANGE]" >
               <choice value="0" name="Disabled"     enum="Disabled"      enabledBy="true"                          ref="Disabled" />

               <choice value="0" name="/1 (low)"     enum="LowDivBy1"     enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]"      />
               <choice value="1" name="/2 (low)"     enum="LowDivBy2"     enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]/2"    />
               <choice value="2" name="/4 (low)"     enum="LowDivBy3"     enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]/4"    />
               <choice value="3" name="/8 (low)"     enum="LowDivBy8"     enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]/8"    />
               <choice value="4" name="/16 (low)"    enum="LowDivBy16"    enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]/16"   />
               <choice value="5" name="/32 (low)"    enum="LowDivBy32"    enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]/32"   />
               <choice value="6" name="/64 (low)"    enum="LowDivBy64"    enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]/64"   />
               <choice value="7" name="/128 (low)"   enum="LowDivBy128"   enabledBy="(/OSC0/osc_cr_range == false)" ref="ics_erc_clock[%(n)]/128"  />

               <choice value="0" name="/32 (high)"   enum="HighDivBy32"   enabledBy="(/OSC0/osc_cr_range == true)" ref="ics_erc_clock[%(n)]/32"   />
               <choice value="1" name="/64 (high)"   enum="HighDivBy64"   enabledBy="(/OSC0/osc_cr_range == true)" ref="ics_erc_clock[%(n)]/64"   />
               <choice value="2" name="/128 (high)"  enum="HighDivBy128"  enabledBy="(/OSC0/osc_cr_range == true)" ref="ics_erc_clock[%(n)]/128"  />
               <choice value="3" name="/256 (high)"  enum="HighDivBy256"  enabledBy="(/OSC0/osc_cr_range == true)" ref="ics_erc_clock[%(n)]/256"  />
               <choice value="4" name="/512 (high)"  enum="HighDivBy512"  enabledBy="(/OSC0/osc_cr_range == true)" ref="ics_erc_clock[%(n)]/512"  />
               <choice value="5" name="/1024 (high)" enum="HighDivBy1024" enabledBy="(/OSC0/osc_cr_range == true)" ref="ics_erc_clock[%(n)]/1024" />
               <choice value="6" name="Reserved"     enum="Reserved6"     enabledBy="(/OSC0/osc_cr_range == true)" ref="Disabled"   />
               <choice value="7" name="Reserved"     enum="Reserved7"     enabledBy="(/OSC0/osc_cr_range == true)" ref="Disabled"  />
            </choiceOption>

            <intOption key="ics_erc_clock_divided[%(n)]"
               enabledBy="ics_c1_rdiv[%(n)]!=0"
               derived="true"
               locked="true"
               units="Hz"
               description="Divided external reference clock"
               toolTip="ics_erc_clock after RDIV"
               value="32000"
               disabledValue="0" />

            <binaryOption key="ics_c1_irefs[%(n)]"
               ref="(icsClockMode[%(n)]==FEI)||(icsClockMode[%(n)]==FBI)||(icsClockMode[%(n)]==FBILP)"
               typeName="IcsIref"
               target="irefs_clock[%(n)]"
               derived="true"
               locked="true"
               description="Internal Reference Select"
               disabledValue="1"
               toolTip="Selects the reference clock source for the FLL\n
                        This option is determined by the Clock Mode selection" >
               <choice value="0" name="External Reference Clock" enum="External" ref="ics_erc_clock_divided[%(n)]" />
               <choice value="1" name="Internal Reference Clock" enum="Internal" ref="icsirclk" isDefault="true" />
            </binaryOption>

            <intOption key="irefs_clock[%(n)]"
               enabledBy="(%(n)==0)||enableClockConfiguration[%(n)]"
               derived="true"
               hidden="true" />

            <intOption key="system_icsffclk_clock[%(n)]"
               ref="irefs_clock[%(n)]"
               enabledBy="((%(n)==0)||enableClockConfiguration[%(n)]) &amp;&amp;
                          ((irefs_clock[%(n)]&lt;=(system_icsoutclk_clock[%(n)]/8))&amp;&amp;(icsClockMode[%(n)]!=FBILP))"
               units="Hz"
               derived="true"
               locked="true"
               description="ICS Fixed Frequency Clock [ICSFFCLK]"
               isNamedClock="true"
               toolTip="Used as input clock to FLL and available to some peripherals\n
                        Derived from External Reference Clock or Slow IRC"
               value="0"/>

            <intOption key="fllInputFrequency[%(n)]"
               ref="irefs_clock[%(n)]"
               derived="true"
               locked="true"
               units="Hz"
               description="FLL Input clock frequency"
               toolTip="Frequency of input to FLL"
               disabledValue="0" />

            <intOption key="system_icsfllclk_clock[%(n)]"
               enabledBy="fll_enabled[%(n)]&amp;&amp;((fllInputFrequency[%(n)]&gt;=31.25_kHz)&amp;&amp;(fllInputFrequency[%(n)]&lt;=39.0625_kHz))"
               ref="fllInputFrequency[%(n)]*1280"
               derived="true"
               locked="true"
               max="50_MHz"
               units="Hz"
               description="ICS FLL Output clock [ICSFLLCLK]"
               isNamedClock="true"
               toolTip="Output of FLL.\n
                        Available as ICSFLLCLK and used for ICSOUTCLK in FEI or FEE clock modes"
               value="40000000"
               disabledValue="0" />

         </category>

         <aliasOption key="system_icsffclk_clock[%(n)]" />
         <aliasOption key="system_icsfllclk_clock[%(n)]" />

         <choiceOption key="ics_c1_clks[%(n)]" condition="ics_c1_clks_present"
            ref="((icsClockMode[%(n)]==FEI)||(icsClockMode[%(n)]==FEE))?0b00:
                 ((icsClockMode[%(n)]==FBI)||(icsClockMode[%(n)]==FBILP))?0b01:0b10
                 #icsClockMode[%(n)]"
            typeName="IcsClkSrc"
            target="icsoutclk_undivided[%(n)]"
            derived="true"
            locked="true"
            description="ICS Output Clock Source Select"
            toolTip="Selects the clock source for ICSOUTCLK\n
                     This option is determined by the Clock Mode selection" >
            <choice value="0" name="Output of FLL"            enum="Fll"   ref="system_icsfllclk_clock[%(n)]" />
            <choice value="1" name="Internal reference clock" enum="Iref"  ref="icsirclk" />
            <choice value="2" name="External reference clock" enum="Eref"  ref="ics_erc_clock[%(n)]" />
         </choiceOption>

         <intOption key="icsoutclk_undivided[%(n)]"
            hidden="true"
            derived="true"
            locked="true" />

         <choiceOption key="ics_c2_bdiv[%(n)]" condition="ics_c2_bdiv_present"
            enabledBy="((%(n)==0)&amp;&amp;assumeSlowIrcTrimmed)||enableClockConfiguration[%(n)]#enableClockConfiguration[%(n)]"
            target="system_icsoutclk_clock[%(n)]"
            typeName="IcsBusDivider"
            description="Output divider for ICS"
            toolTip="This divides the output of the ICS.\n
                     If in FEI mode and the ICS internal clock is not trimmed,\n
                     then BDIV should be &gt;1 to prevent an excessive bus speed"
            disabledValue="1" >
            <choice name="Divide by 1"    value="0" enum="DivideBy1"    ref="icsoutclk_undivided[%(n)]"     />
            <choice name="Divide by 2"    value="1" enum="DivideBy2"    ref="icsoutclk_undivided[%(n)]/2"   />
            <choice name="Divide by 4"    value="2" enum="DivideBy4"    ref="icsoutclk_undivided[%(n)]/4"   />
            <choice name="Divide by 8"    value="3" enum="DivideBy8"    ref="icsoutclk_undivided[%(n)]/8"   />
            <choice name="Divide by 16"   value="4" enum="DivideBy16"   ref="icsoutclk_undivided[%(n)]/16"  />
            <choice name="Divide by 32"   value="5" enum="DivideBy32"   ref="icsoutclk_undivided[%(n)]/32"  />
            <choice name="Divide by 64"   value="6" enum="DivideBy64"   ref="icsoutclk_undivided[%(n)]/64"  />
            <choice name="Divide by 128"  value="7" enum="DivideBy128"  ref="icsoutclk_undivided[%(n)]/128" />
         </choiceOption>

         <intOption key="system_icsoutclk_clock[%(n)]"
               enabledBy="(%(n)==0)||enableClockConfiguration[%(n)]"
            max="50_MHz"
            min="1"
            derived="true"
            locked="true"
            units="Hz"
            description="ICS Output Clock [ICSOUTCLK]"
            isNamedClock="true"
            toolTip="ICS Main clock output"
            value="120000000"
            disabledValue="0" />

         <aliasOption key="/SIM/system_core_clock[%(n)]"    locked="false"  optional="true" />
         <aliasOption key="/SIM/system_bus_clock[%(n)]"     locked="false"  optional="true" />
         <aliasOption key="/SIM/system_flexbus_clock[%(n)]" locked="false"  optional="true" />
         <aliasOption key="/SIM/system_flash_clock[%(n)]"   locked="false"  optional="true" />

         <category name="Device Parameters" description="Register values" >
            <category name="OSC_CR" description="ICS Control Register 2" >
               <aliasOption key="/OSC0/osc_cr_oscen"       optional="true" />
               <aliasOption key="/OSC0/osc_cr_oscsten"     optional="true" />
               <aliasOption key="/OSC0/osc_cr_oscos"       optional="true" />
               <aliasOption key="/OSC0/osc_cr_range"       optional="true" />
               <aliasOption key="/OSC0/osc_cr_hgo"         optional="true" />
            </category>

            <category name="ICS_C1" description="ICS Control Register 1" >
               <aliasOption key="ics_c1_clks[%(n)]" />
               <aliasOption key="ics_c1_rdiv[%(n)]" />
               <aliasOption key="ics_c1_irefs[%(n)]" />
               <aliasOption key="ics_c1_irclken[%(n)]" />
               <aliasOption key="ics_c1_irefsten[%(n)]" />
            </category>

            <category name="ICS_C2" description="ICS Control Register 2" >
               <aliasOption key="ics_c2_bdiv[%(n)]"              optional="true" />

               <binaryOption key="ics_c2_lp[%(n)]"
                  typeName="IcsFllInLowpower"
                  derived="true"
                  locked="true"
                  description="Low Power Select"
                  toolTip="Whether FLL continues operation when bypassed\n
                           This option is determined by the Clock Mode selection" >
                  <choice value="0" enum="Enabled"  name="FLL is enabled in bypass modes" />
                  <choice value="1" enum="Disabled" name="FLL is disabled in bypass modes" />
               </binaryOption>
            </category>

            <category name="ICS_C4" description="ICS Control Register 4" >
               <aliasOption key="ics_c4_lolie0[%(n)]" />
               <aliasOption key="ics_c4_cme[%(n)]" />
            </category>
         </category>
      </categoryOption>
   </for>

<!--   __________ Methods _______________________________ -->

   <variableTemplate codeGenCondition="!enablePeripheralSupport"
      variables="ics_c2_bdiv[0],ics_c2_lp[0]"
      terminator=";"
   ><![CDATA[
      \t/// ICS_C2 value used for ICS minimal configuration
      \tstatic constexpr uint8_t ics_c2 = %initExpression;
      \t\n
   ]]></variableTemplate>

   <variableTemplate variables="ics_oscsel_fixed[]"
   ><![CDATA[
      \t/**
      \t * Get %description
      \t *
      \t * @return Clock frequency in Hz
      \t */
      \tstatic uint32_t getExternalReferenceClock() {
      \t
      \t   return $(%variable0.code[0]);
      \t}\n\n
      ]]></variableTemplate>

   <clockCodeTemplate variable="ics_c1_irclken[]"
      returnFormat="%s"
   ><![CDATA[
      \t//! ICS Internal Reference Clock
      \tstatic constexpr unsigned icsirclk = $(icsirclk);
      \t
      \t/**
      \t * Set %description
      \t *
      \t * @param %paramName %tooltip
      \t */
      \tstatic void enableIcsIrClock(%paramType %paramName) {
      \t   %fieldAssignment;
      \t}

      \t/**
      \t * Get %description
      \t *
      \t * @return Clock frequency in Hz
      \t */
      \tstatic uint32_t getUngatedInternalReferenceClock() {
      \t   return icsirclk;
      \t}

      \t/**
      \t * Get %description
      \t *
      \t * @return Clock frequency in Hz
      \t */
      \tstatic uint32_t getInternalReferenceClock() {
      \t
      \t   switch(%maskingExpression) {
      \t      default: return 0;
      %body
      \t   }
      \t}\n\n
      ]]></clockCodeTemplate>

   <for keys="n" dim="=/SIM/numberOfClockSettings" >
      <template key="ClockConfig" codeGenCondition="enableClockConfiguration[%(n)]" ><![CDATA[
         \t$(ClockConfig[%(n)]://-- missing name for configuration --),\n
      ]]></template>
   </for>

   <for keys="n" dim="=/SIM/numberOfClockSettings" >
      <template key="IcsClockInfoEntries" codeGenCondition="enableClockConfiguration[%(n)]"
      ><![CDATA[
         \t{  // $(ClockConfig[%(n)]) ($(icsClockMode[%(n)].enum[]))
         \t\n
      ]]></template>

      <variableTemplate key="IcsClockInfoEntries" codeGenCondition="enableClockConfiguration[%(n)]"
         terminator=","
         variables="
            /SIM/sim_clkdiv_outdiv3[%(n)],
            /SIM/sim_clkdiv_outdiv2[%(n)],
            /SIM/sim_clkdiv_outdiv1[%(n)]"
      ><![CDATA[\t   /// SIM CLKDIV1 System Clock Divider Register 1 %initExpression\n\n ]]></variableTemplate>

      <variableTemplate key="IcsClockInfoEntries" codeGenCondition="enableClockConfiguration[%(n)]"
         terminator=","
         variables="
            icsClockMode[%(n)]"
      ><![CDATA[\t   /// Clock Mode %initExpression\n\n ]]></variableTemplate>

      <variableTemplate key="IcsClockInfoEntries" codeGenCondition="enableClockConfiguration[%(n)]"
         terminator=","
         variables="
            ics_c1_rdiv[%(n)],
            ics_c1_irclken[%(n)],
            ics_c1_irefsten[%(n)]"
      ><![CDATA[\t   /// Control Register 1 - Excluding CLKS, IREFS %initExpression\n\n ]]></variableTemplate>

      <variableTemplate key="IcsClockInfoEntries" codeGenCondition="enableClockConfiguration[%(n)]"
         terminator=","
         variables=
            "ics_c2_bdiv[%(n)]"
      ><![CDATA[\t   /// Control Register 2 - Excluding LP, FCTRIM %initExpression\n\n ]]></variableTemplate>

      <variableTemplate key="IcsClockInfoEntries" codeGenCondition="enableClockConfiguration[%(n)]"
         terminator=","
         variables=
            "ics_c4_cme[%(n)],
             ics_c4_lolie0[%(n)]"
      ><![CDATA[\t   /// Control Register 4 - Excluding FCTRIM, SCFTRIM %initExpression\n\n ]]></variableTemplate>

      <template key="IcsClockInfoEntries" codeGenCondition="enableClockConfiguration[%(n)]" ><![CDATA[
         \t},\n
      ]]></template>
   </for>

   <template key="ClockInfoType" ><![CDATA[
      \t/// Structure for clock configurations
      \tstruct ClockInfo {\n\n
   ]]></template>

   <template key="ClockInfoType" where="all"
      condition="/SIM/sim_clkdiv_outdiv3[]||/SIM/sim_clkdiv_outdiv2[]||/SIM/sim_clkdiv_outdiv1[]"
   ><![CDATA[
      \t   /// SIM CLKDIV1 - System Clock Divider Register 1
      \t   const uint32_t clkdiv1;\n\n ]]>
   </template>

   <template key="ClockInfoType" where="all"
      condition="(/SIM/sim_sopt2_pllfllsel[])||(/SIM/sim_sopt2_tpmsrc[])"
   ><![CDATA[
      \t   /// SIM SOPT2 - Clock selectors for various peripherals
      \t   const uint32_t sopt2;\n\n ]]>
   </template>


   <template key="ClockInfoType" where="all"
      condition="icsClockMode[]"
   ><![CDATA[
      \t   /// Clock Mode
      \t   const IcsClockMode clockMode;\n\n
   ]]></template>

   <template key="ClockInfoType" where="all"
      condition="ics_c1_rdiv[]||ics_c1_irclken[]||ics_c1_irefsten[]"
   ><![CDATA[
      \t   /// Control Register 1 - RDIV, IRCLKEN, IREFSTEN, (-CLKS, -IREFS)
      \t   const uint8_t c1; \n ]]></template>

   <template key="ClockInfoType" where="all"
      condition="ics_c2_bdiv[]"
   ><![CDATA[
      \t   /// Control Register 2 - BDIV, (-LP)
      \t   const uint8_t c2;\n ]]></template>

   <template key="ClockInfoType" where="all"
      condition="ics_c4_lolie0[]||ics_c4_cme[]"
   ><![CDATA[
      \t   /// Control Register 4 - DMX32, DRST_DRS, (-FCTRIM, -SCFTRIM)
      \t   const uint8_t c4;\n ]]></template>

   <template key="ClockInfoType" ><![CDATA[
      \t};\n\n
   ]]></template>

   <for keys="field:name"
        values="
      ics_c1_clks[]:C1Clks;
      ics_c1_rdiv[]:C1Rdiv;
      ics_c1_irefs[]:C1Irefs;
      ics_c1_irclken[]:C1Irclken;
      ics_c1_irefsten[]:C1Irefsten;
      ics_c2_bdiv[]:C2Bdiv;
      ics_c2_lp[]:C2Lp;
      ics_c4_lolie0[]:C4Lolie0;
      ics_c4_cme[]:C4Cme" >
      <variableTemplate variables="%(field)"
      ><![CDATA[
         \t/**
         \t * Set %description
         \t *
         %paramDescription
         \t */
         \tstatic void configure%(name)(%params) {
         \t   %fieldAssignment;
         \t}\n\n
      ]]></variableTemplate>
   </for>


<!--   Configure methods -->

   <!--
      Global clock frequencies
   -->
   <template where="usbdm" codeGenCondition="/ICS/enablePeripheralSupport" ><![CDATA[
      \t/*
      \t * Global clocks
      \t */
      \t\n
   ]]></template>
   <template where="usbdm" codeGenCondition="!/ICS/enablePeripheralSupport" ><![CDATA[
      \t/*
      \t * Global clock constants
      \t * These are provided when minimal clock generator code is used.
      \t * They assume no clock changes are made after startup.
      \t * Values provided are from USBDM configuration.
      \t */
      \t\n
   ]]></template>

   <for keys=" clock                       : name "
      values=" system_icsffclk_clock[0]    : SystemIcsFFClock;
               system_icsoutclk_clock[0]   : SystemIcsOutClock;
               system_icsfllclk_clock[0]   : SystemIcsFllClock
         ">
      <variableTemplate where="usbdm" variables="%(clock)" codeGenCondition="/ICS/enablePeripheralSupport"
                   tooltipPadding="x*xx" ><![CDATA[
         \t/**
         \t *  %description
         \t *  %tooltip
         \t *  (Full configuration - declaration)
         \t */
         \textern volatile uint32_t %(name);
         \t\n
      ]]></variableTemplate>
      <variableTemplate key="/$(_BASENAME)/clocks" variables="%(clock)" codeGenCondition="/ICS/enablePeripheralSupport"
                   tooltipPadding="x*xx" ><![CDATA[
         \t/**
         \t *  %description
         \t *  %tooltip
         \t *  (Full configuration - definition)
         \t */
         \tvolatile uint32_t %(name);
         \t\n
      ]]></variableTemplate>
      <variableTemplate where="usbdm" variables="%(clock)" codeGenCondition="!/ICS/enablePeripheralSupport"
                   tooltipPadding="x*xx" ><![CDATA[
         \t/**
         \t *  %description
         \t *  %tooltip
         \t *  (Minimal configuration - definition)
         \t */
         \tconstexpr uint32_t %(name) = %valueExpression;
         \t\n
      ]]></variableTemplate>
   </for>

   <!-- _____________ Common __________________ -->

   <template key="/ICS/Includes"  ><![CDATA[
   #include "osc.h"\n
   ]]></template>

   <template key="/$(_BASENAME)/ClockStartup" ><![CDATA[
   \tUSBDM::$(_Class)::startupConfigure();\n
   ]]></template>

   <validate
      class="net.sourceforge.usbdm.deviceEditor.validators.IcsValidator" dim="=/SIM/numberOfClockSettings" >
   </validate>

   <projectActionList id="ics_files" >
      <copy source="Project_Headers/ics-mke.h"         target="Project_Headers/ics.h"                 overwrite="true"  derived="true" />
      <copy source="Startup_Code/ics.cpp"              target="Startup_Code/ics.cpp"                  overwrite="true"  derived="true" />
      <copy source="Snippets/ics-test.cpp"             target="Snippets/ics-test.cpp"                 overwrite="true"  derived="true" />
      <deleteResource target="Project_Headers/clock_configure.h" />
      <deleteResource target="Startup_Code/clock.c" />
   </projectActionList>

</peripheralPage>
